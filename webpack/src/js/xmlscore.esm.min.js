import"core-js/modules/es.array.concat";import"core-js/modules/es.function.name";import"core-js/modules/es.object.assign";import"core-js/modules/es.number.constructor";import t from"vue";import"core-js/modules/es.array.filter";import"core-js/modules/es.regexp.flags";function e(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return i(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function n(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=s(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw a}}}}var o,a,r,l;!function(t){t.slur="slur",t.tied="tied",t.tuplet="tuplet",t.slide="slide",t.tremolo="tremolo",t.wavyLine="wavy-line",t.glissando="glissando"}(o||(o={})),function(t){t.tenuto="tenuto",t.fermata="fermata",t.accent_staccato="accent_staccato",t.accent_tenuto="accent_tenuto",t.detached_legato="detached-legato",t.upBow="up-bow",t.downBow="down-bow",t.staccatissimo="staccatissimo",t.spiccato="spiccato",t.strongAccent="strong-accent",t.scoop="scoop",t.fingering="fingering",t.arpeggiate="arpeggiate",t.fret_string="fret_string",t.staccato="staccato",t.breathMark="breath-mark"}(a||(a={})),function(t){t.Sharp="Sharp",t.Flat="Flat",t.Natural="Natural",t.DoubleFlat="DoubleFlat",t.DoubleSharp="DoubleSharp"}(r||(r={})),function(t){t.Treble="Treble",t.bass="bass",t.bass3="Bass3",t.TAB="TAB",t.Percussion="Percussion",t.Treble8vb="Treble8vb",t.Treble8va="Treble8va"}(l||(l={}));class h{constructor(){this.inbeam=!1,this.tick=0,this.type=4,this.staff=1,this.v=1,this.x=0,this.dots=0,this.cue=!1,this.partIndex=0,this.mm=0,this.tails=0}static newElem(){return{line:0,val:0,step:0,octave:0}}static elemStaff(t,e){return e.staff||t.staff||1}static calcNoteElem(t,e,s){if(t.elems)for(const i of t.elems){if(!i.val)continue;const n=e[this.elemStaff(t,i)];let o=0;const a=h.noteInfos[s+7][i.val%12],l=a[0],c=Number(a[1]),f=Math.floor(i.val/12);o="Treble"===n?c-7+7*(f-5):c-7+7*(f-4)+5,i.line=o;const u="#"===l?r.Sharp:"b"===l?r.Flat:"n"===l?r.Natural:null;u&&(i.acc={acc:u})}}}h.uitool=!1,h.noteInfos=[["n1"," 2","n2"," 3"," 4","n4"," 5","n5"," 6","n6"," 7"," 1"],["n1"," 2","n2"," 3","n3"," 4"," 5","n5"," 6","n6"," 7"," 1"],[" 1"," 2","n2"," 3","n3"," 4"," 5","n5"," 6","n6"," 7","n7"],[" 1"," 2","n2"," 3","n3"," 4","b5"," 5"," 6","n6"," 7","n7"],[" 1","b2"," 2"," 3","n3"," 4","b5"," 5"," 6","n6"," 7","n7"],[" 1","b2"," 2"," 3","n3"," 4","b5"," 5","b6"," 6"," 7","n7"],[" 1","b2"," 2","b3"," 3"," 4","b5"," 5","b6"," 6"," 7","n7"],[" 1","#1"," 2","b3"," 3"," 4","#4"," 5","b6"," 6","b7"," 7"],[" 1","#1"," 2","#2"," 3","n4"," 4"," 5","#5"," 6","#6"," 7"],["n1"," 1"," 2","#2"," 3","n4"," 4"," 5","#5"," 6","#6"," 7"],["n1"," 1"," 2","#2"," 3","n4"," 4","n5"," 5"," 6","#6"," 7"],["n1"," 1","n2"," 2"," 3","n4"," 4","n5"," 5"," 6","#6"," 7"],["n1"," 1","n2"," 2"," 3","n4"," 4","n5"," 5","n6"," 6"," 7"],["n1"," 1","n2"," 2","n3"," 3"," 4","n5"," 5","n6"," 6"," 7"],[" 7"," 1","n2"," 2","n3"," 3"," 4","n5"," 5","n6"," 6","n7"]];class c{constructor(t,e,s,i=!1){this.score=t,this.lines=e,this.lineh=s,this.oneline=i,this.continues={},this.checkContinues()}getContinueItem(t){return this.continues[t]}checkContinues(){for(let t=0;t<this.lines.length;t++){const e=this.lines[t];for(let s=0;s<e.lineStaves.length;s++){const i=e.lineStaves[s];let n=i.distances[i.distances.length-1];if(t<this.lines.length-1){const e=this.lines[t+1].lineStaves[s];n=e.distances[e.distances.length-1]}const o=i.parti,a=this.score.parts[o],r=[];let l=0;const h=a.measures[e.m1].keyw||(6+Math.abs(i.fifths))*this.lineh;for(let t=e.m1;t<e.m2;t++){const s=a.measures[t];s.pdirs&&this.continuePDirs(r,s.pdirs,e,l);const o=t<a.measures.length-1&&a.measures[t+1].keyw||0;this.continueDirs(s,o,e,l),this.continueSlurs(r,s,o,e,l,n,h),s.ends&&this.continueEnds(r,a,s,s.ends,e,i.fifths,l),l+=s.w}if(r.length>0)for(const e of r){const s=e.continueOffset?e.continueOffset:1;let i=this.continues[t+s];i||(i={},this.continues[t+s]=i);let n=i[o];n||(n=[],i[o]=n),n.push(e)}}}}continueEnds(t,e,s,i,n,o,a){i.discontinue=!1,i.m1===n.m1?i.x1=this.lineh*(Math.abs(o)+6):i.x1=0;let r=s.w;if(this.oneline&&s.keyw&&(r-=s.keyw),i.m2>i.m1)for(let l=i.m1+1;l<=i.m2;l++){const t=e.measures[l];if(r+=t.w,this.oneline&&t.keyw&&(r-=t.keyw),l>=n.m2){i.stop=!1,i.discontinue=!0,r=n.w-a;break}}i.x2=r-5}continueDirs(t,e,s,i){if(t.dirs)for(const n of t.dirs)if("pedal"===n.type&&n.line)if(this.oneline)n.x1=n.param.x-(t.keyw||0),n.stopx&&(n.x2=n.stopx-(t.keyw||0),e&&n.x2>t.w&&(n.x2=n.stopx-e));else if(n.x1=n.param.x,n.stopx){n.x2=n.stopx;i+n.stopx-s.w>0&&(n.x2=s.w-i)}}continuePDirs(t,e,s,i){for(const n of e){if(n.x2=n.stopx,n.continueOffset=void 0,this.oneline)continue;let e=i+n.x2-s.w;if(e>0){let o=1;for(;e>0;){const i=e>s.w?s.w:e;t.push(Object.assign(Object.assign({},n),{x1:8*this.lineh,x2:i,y1:n.y2,continueOffset:o})),e-=s.w,o++}n.continueOffset=0,n.x2=s.w-i,n.y2=n.y1}}}slurPair(t,e,s,i){return{type:"tied"===t.type?"slur":t.type,slur:t,notex:e,notey:s,staffDistance:i,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stopx:0,staff:1}}continueSlurs(t,e,s,i,n,o,a){if(e.notes)for(const r of e.notes){if(!r.elems)continue;const l=(4-r.elems[r.elems.length-1].line)*this.lineh/2;for(let h=0;h<r.elems.length;h++){const c=r.elems[h];if(!c.pairs)continue;let f=(4-c.line)*this.lineh/2,u=l;const p=c.staff||r.staff||1;p>1&&(f+=(4*this.lineh+o)*(p-1),u+=(4*this.lineh+o)*(p-1));for(const l of c.pairs)if("slur"===l.type||"tied"===l.type||"wavy-line"===l.type){const c=n+l.x2+r.x,m=l.up&&"slur"===l.type?u:f;if(l.contx&&(l.contx=void 0,l.conty=void 0),this.oneline){s&&l.x2+r.x>e.w&&(l.contx=l.x2-s,l.conty=l.y2);continue}const d=c-i.w-a;if(0===h&&"tied"===l.type&&c>i.w+this.lineh){let e=-(r.elems.length-1.5)*this.lineh*2.3;p>1&&(e+=(4*this.lineh+o)*(p-1));const s=Object.assign(Object.assign({},l),{x1:0,x2:d}),i=this.slurPair(s,a,e,o);i.jianpu=!0,t.push(i)}if(l.cx1||l.cy1){const e=Object.assign(Object.assign({},l),{y1:l.y2,x1:-10,x2:d,bx1:void 0,by1:void 0});void 0===l.bx2&&(e.bx1=void 0,e.by1=void 0),l.cy2&&(e.y1=l.cy2),void 0!==l.contbx&&(l.contbx=void 0,l.contby=void 0),e.x2<e.x1+20&&(e.x1=e.x2-1.5*this.lineh,e.bx1=void 0,e.by1=void 0);const s=this.slurPair(e,a,m,o);t.push(s),l.contx=l.cx1,l.conty=l.cy1,l.contbx=l.cbx1,l.contby=l.cby1}else if(c>i.w+2*this.lineh){const e="slur"===l.type?l.up?-5:5:0,s=Object.assign(Object.assign({},l),{y1:l.y2+e,x1:0,x2:d}),h=this.slurPair(s,a,m,o);t.push(h),l.contx=i.w-n-r.x,l.conty=l.y1+e}}}}}}class f{static calcScoreMargin(t,e){for(const s of t.lines)for(const i of s.lineStaves){let n=0,o=4*e;for(let t=1;t<=i.distances.length;t++)if(!(i.details&&i.details[t]&&i.details[t].hide)){if(n=t,i.details&&i.details[t]&&5!==i.details[t].lines){o=(i.details[t].lines-1)*e}break}if(0===n)o=0;else for(let t=n;t<i.distances.length;t++)i.details&&i.details[t+1]&&i.details[t+1].hide||(o+=i.distances[t]+4*e);i.height=o;const a=t.parts[i.parti];for(let t=s.m1;t<s.m2;t++){const s=a.measures[t];this._getMeasureRange(s,i,e)}}this.calcLineStaffRange(t,t.lines)}static calcLineStaffRange(t,e){for(const s of e)for(const e of s.lineStaves){if(e.margin)return;let i=0,n=0,o=0,a=0;const r=t.parts[e.parti];for(let t=s.m1;t<s.m2;t++){const e=r.measures[t].margin;e&&(i=Math.max(i,e.top),n=Math.max(n,e.bottom),o=Math.max(o,e.topJp),a=Math.max(a,e.bottomJp))}e.margin={top:i,bottom:n,topJp:o,bottomJp:a,yOrig:e.y}}}static _yOf(t,e,s,i){for(let n=1;n<s.distances.length&&n<e;n++)t+=s.distances[n]+4*i;return t}static _getNoteRange(t,e,s,i,n){let o=t.topy,a=t.bottomy;if(void 0!==e.rest&&0!==e.rest.line){const t=this._yOf(5*(4-e.rest.line),e.staff,s,i);t-10<o&&(o=t-10),t+10>a&&(a=t+10)}if(void 0===e.elems)return{topy:o,bottomy:a};if(n){if(o=Math.min(o,-(e.elems.length+1)*i*1.5),void 0!==e.v)if(e.v>0){const t=this._yOf(60,e.staff,s,i);a=Math.max(a,t)}else{const t=this._yOf(-60,e.staff,s,i);o=Math.min(o,t)}if(void 0!==e.lyrics)for(const t of e.lyrics)o=Math.min(o,t.param.y+40-20),a=Math.max(a,t.param.y+20);return{topy:o,bottomy:a}}for(const l of e.elems){const t=this._yOf(5*(4-l.line),e.staff,s,i);if(o=Math.min(o,t-10),a=Math.max(a,t+10),void 0!==l.pairs)for(const n of l.pairs){let r=t;if(n.up){const t=e.elems[e.elems.length-1];r=this._yOf(5*(4-t.line),e.staff,s,i)}const l="slur"===n.type||"tied"===n.type?(n.x2-n.x1)/20+5:10,h=n.y1+r,c=n.y2+r;o=Math.min(o,h-l,c-l),a=Math.max(a,h+l,c+l)}}const r=this._yOf(5*(4-e.elems[0].line),e.staff,s,i);if(void 0!==e.stem&&(o=Math.min(o,e.stem.y+r-5),a=Math.max(a,e.stem.y+r+5)),void 0!==e.arts)for(const l of e.arts)o=Math.min(o,l.y+r-15),a=Math.max(a,l.y+r+15);if(void 0!==e.lyrics)for(const l of e.lyrics)o=Math.min(o,l.param.y+40-20),a=Math.max(a,l.param.y+20);return{topy:o,bottomy:a}}static _getMeasureRange(t,e,s){let i=-25,n=(e.height||40)+20;const o=e.clef&&e.clef[1]===l.TAB;if(void 0!==t.dirs)for(const l of t.dirs){let t=l.param.y;void 0!==t&&(t=this._yOf(t,l.staff,e,s),i=Math.min(i,t-20),n=Math.max(n,t+20))}if(void 0!==t.pdirs)for(const l of t.pdirs){const t=this._yOf(l.y1,l.staff,e,s),o=this._yOf(l.y2,l.staff,e,s);i=Math.min(i,t-20,o-20),n=Math.max(n,t+20,o+20)}if(void 0!==t.ends){const e=t.ends.y;i=Math.min(i,e-20)}if(void 0!==t.harmonys)for(const l of t.harmonys){let t=this._yOf(l.y,l.staff,e,s);o&&(t-=40),i=Math.min(i,t-20,t-20)}let a=i,r=n;for(const l of t.notes){const t=this._getNoteRange({topy:i,bottomy:n},l,e,s,!1);i=Math.min(i,t.topy),n=Math.max(n,t.bottomy);const o=this._getNoteRange({topy:a,bottomy:r},l,e,s,!0);a=Math.min(a,o.topy),r=Math.max(r,o.bottomy)}const h=e.height||40;t.margin={top:-i,bottom:h<n?n-h:20,topJp:-a,bottomJp:h<r?r-h:20}}}class u{static calMeasure(t,e,s,i){const n=[];let o=0,a=0;for(const r of t.notes){n.includes(r.tick)||n.push(r.tick),r.ticks=this.noteTicks[r.type],r.dots&&(r.ticks*=1.5);const t=r.tick+r.ticks;if(o<t&&(o=t),r.elems){const t=s[r.staff];for(const s of r.elems)s.id="n_"+e+"_"+a,a++,s.val=12*(s.octave+1)+this.valueOfStep[s.step]+(s.alter||0),this.setElemLine(s,t),this.setElemAcc(s,i)}if(r.arts)for(const e of r.arts)void 0===e.x&&(e.x=2),void 0===e.y&&(e.up?e.y=-12:e.y=12);r.tails=this.noteTails[r.type]||0}t.cols=n.length<4?4:n.length,t.ticks=o}static setElemAcc(t,e){1===t.alter?e>0&&4===t.step||e>1&&1===t.step||e>2&&5===t.step||e>3&&2===t.step||e>4&&6===t.step||e>5&&3===t.step||e>6&&7===t.step||(t.acc={acc:r.Sharp}):-1===t.alter?e<0&&7===t.step||e<-1&&3===t.step||e<-2&&6===t.step||e<-3&&2===t.step||e<-4&&5===t.step||e<-5&&1===t.step||e<-6&&4===t.step||(t.acc={acc:r.Flat}):-2===t.alter?t.acc={acc:r.DoubleFlat}:2===t.alter?t.acc={acc:r.DoubleSharp}:(e>0&&4===t.step||e>1&&1===t.step||e>2&&5===t.step||e>3&&2===t.step||e>4&&6===t.step||e>5&&3===t.step||e>6&&7===t.step||e<0&&7===t.step||e<-1&&3===t.step||e<-2&&6===t.step||e<-3&&2===t.step||e<-4&&5===t.step||e<-5&&1===t.step||e<-6&&4===t.step)&&(t.acc={acc:r.Natural})}static setElemLine(t,e){t.line=t.step+7*(t.octave-4),e===l.Treble?t.line-=7:e===l.bass&&(t.line+=5)}}u.valueOfStep=[0,0,2,4,5,7,9,11],u.noteTicks={0:1920,2:960,4:480,8:240,16:120,32:60,64:30},u.noteTails={8:1,16:2,32:3,64:4,128:5,256:6};class p{static autoLayout(t){t.page||(t.page={l1:0,ls:0,x:72,y:72,w:1200,h:1643}),t.lines||(t.measInfo=[],this.genLines(t),this.setNotePos(t),class{static autoBeam(t){var e;const s=t.parts[0];for(const i of s.measures){let t=[];for(const s of i.notes){if(!s.elems||s.type<2)continue;const i=s.elems[s.elems.length-1],n=s.elems[0],o=5*(i.line-n.line);if(this.createStem(s,i,n,o),!(s.type<=4)&&(s.inbeam=!1,t.push(s),(s.tick+(s.ticks||0))%480==0)){const s=t[0],i=this.baseNoteY(s),n=!0===(null===(e=s.stem)||void 0===e?void 0:e.up),a=t[t.length-1],{lineK:r,y1:l,y2:h}=this.beamY12(s,a,t,n,o);for(let e=0;e<t.length;e++){const o=t[e],c=(o.x-s.x)*r+l-this.baseNoteY(o);o.stem={y:c,up:n},o.inbeam=!0;const f=e>0?t[e-1].tails:0;if((e<t.length-1?t[e+1].tails:0)>=o.tails)for(let n=f;n<o.tails;n++){let r=a;if(n>0)for(let s=e+1;s<t.length;s++){const e=t[s];if(e.tails<=n){r=e;break}}o.beams=[];const c={y1:l-i+6*n,y2:h-i+6*n,x2:r.x-s.x};o.beams.push(c)}}t=[]}}}}static createStem(t,e,s,i){s.line>0?t.stem={y:35,up:!1}:e.line<0?t.stem={y:-35-i,up:!0}:t.stem={y:35,up:!1}}static beamY12(t,e,s,i,n){var o;const a=this.baseNoteY(t),r=this.baseNoteY(e);let l=((null===(o=t.stem)||void 0===o?void 0:o.y)||0)+a,h=(i?-35-n:35)+r;i?l>h+15?l=h+15:h>l+15&&(h=l+15):l<h-15?l=h-15:h<l-15&&(h=l-15);return{lineK:(h-l)/(e.x-t.x),y1:l,y2:h}}static baseNoteY(t){let e=0;return t.elems&&(e+=5*(4-t.elems[0].line)),e}}.autoBeam(t),this.setNotePairs(t))}static genLines(t){const e=t.parts[0],s=[];t.lines=s;const i=e.measures.length;let n=100;const o=.88*t.page.w;let a,r=0,h=0;const c={1:l.Treble,2:l.Treble};let f={beatu:4,beats:4},p=0;for(let l=0;l<i;l++){const t=e.measures[l];if(t.clefs)for(const e of t.clefs)0===e.tick&&(c[e.staff]=e.clef);t.fifths&&(p=t.fifths.fifths),t.time&&(f=t.time),u.calMeasure(t,l,c,p);if(0===l||h>=this.colsPerLine){a&&(a.m2=l,r=l);a={x:0,y:n,w:o,h:200,m1:r,m2:0,distance:100,lineStaves:[{staves:2,fifths:p,parti:0,hidden:!1,y:10,clef:{1:c[1],2:c[2]},time:0===l?f:void 0,distances:[0,120]}]},s.push(a),n+=200,h=0}if(t.clefs)for(const e of t.clefs)c[e.staff]=e.clef;t.fifths&&(p=t.fifths.fifths),t.time&&(f=t.time),h+=t.cols||4}a&&(a.m2=i),console.log(t.lines)}static nextColNote(t,e,s){let i=t.measures[e];const n=i.notes[s];let o;return s<i.notes.length-1&&(o=i.notes[s+1],(o.tick<=n.tick||o.staff!==n.staff)&&(o=void 0)),!o&&e<t.measures.length-1&&(i=t.measures[e],o=i.notes[0]),o}static setNotePairs(t){for(const e of t.parts)for(let t=0;t<e.measures.length;t++){const s=e.measures[t];for(let i=0;i<s.notes.length;i++){const n=s.notes[i];if(n.elems)for(const s of n.elems)if("begin"===s.tied||"endBegin"===s.tied){s.pairs||(s.pairs=[]);const a=this.nextColNote(e,t,i);if(a&&a.x>n.x){const t={x1:0,x2:a.x-n.x,type:o.tied,up:!1,y1:8,y2:8};console.log("next note:",t),s.pairs.push(t)}}}}}static setNotePos(t){const e=t.parts[0];for(const s of t.lines){let t=0,i=0;for(let o=s.m1;o<s.m2;o++){const s=e.measures[o];t+=s.cols||4,i+=s.ticks||480}const n=10*Math.abs(s.lineStaves[0].fifths);let a=s.w-this.keyW-n-2*(s.m2-s.m1)*this.measMargin;for(let o=s.m1;o<s.m2;o++){const t=e.measures[o];(t.time||0===o)&&(a-=this.beatW),t.fifths&&o>s.m1&&(a-=10*Math.abs(t.fifths.fifths))}const r=a/i;for(let l=s.m1;l<s.m2;l++){const t=e.measures[l];let i=this.measMargin;if(l===s.m1&&(i+=this.keyW+n),(0===l||t.time)&&(i+=this.beatW),l>s.m1&&t.fifths&&(i+=10*Math.abs(t.fifths.fifths)),t.w=i+this.measMargin+r*(t.ticks||480),t.clefs)for(const e of t.clefs)void 0===e.x&&(0===e.tick?e.x=0:e.x=i+(e.tick||0)*r);for(const e of t.notes){if(e.x=i+e.tick*r,e.lyrics){let t=1;for(const s of e.lyrics)s.num||(s.num=t),s.param||(s.param={x:e.x,y:50+30*t}),t++}if(e.elems)for(const t of e.elems)if("begin"===t.tied||"endBegin"===t.tied){t.pairs||(t.pairs=[]);const e={x1:0,x2:34,type:o.tied,up:!0,y1:-8,y2:-8};t.pairs.push(e)}}if(null!=t.dirs)for(const e of t.dirs)e.tick&&(e.param={x:i+e.tick*r,y:-20})}}}}p.colsPerLine=20,p.measMargin=10,p.keyW=50,p.beatW=30;class m{constructor(){this.rightHandTrack=0,this.leftHandTrack=1,this.measures={},this.events=[],this.tracks=[{program:0,channel:0},{program:0,channel:1}]}static genMidi(t){const e=new m;return e.genMidi(t),e}genMidi(t){const e=t.parts[0];let s=0;for(let i=0;i<e.measures.length;i++){const t=e.measures[i],n=[];for(const e of t.notes)if(e.elems){for(const t of e.elems){const n={tick:s+e.tick,duration:e.ticks||0,track:e.staff-1,event:[128+e.staff-1,t.val||0,80],staff:e.staff,elem_ids:[t.id||"noid"],note:t.val||0,meas_start_tick:s,part:0,measure:i};this.events.push(n)}n.includes(e.tick)||n.push(e.tick)}this.measures[s]={measure:i,duration:t.ticks||0,note_ticks:n.sort()},s+=t.ticks||0}}}const d=[0,4,1,5,2,6,3,0,4,1,5,2,6,3,0],y=Math.sqrt(2);class x{constructor(t,e,s){this.score=t,this.lineh=e,this.jpFifthsPos={x:0,y:0},this.hiMeasures=[],this.svgSize={width:0,height:0},this.jianpu=0,this.scale=1,this.continues=null,this.showTrackIndexs=null,this.addedNotes=null,this.display="",this.onelineHead={x:0,mm:0,fifths:0,color:"white"},this.classroom=!1,p.autoLayout(t),this.autoMidi=m.genMidi(t),this.prefSize={onelineHeight:0};f.calcScoreMargin(t,e),this.prefSize.onelineHeight=this._onelinePrefHeight(),s.classroom&&(this.classroom=!0),s&&s.w?this.parentw=s.w:this.parentw=3840,s&&s.h?this.parenth=s.h:this.parenth=1080,s.uitool&&(h.uitool=!0);const i=s?s.display:null;this.measureInfos=[],this.pages=[],this.lines=t.lines,this.page=t.page,i&&this.setDisplayMode(i,s.displayParam)}clearNotes(t){t&&this.addedNotes?this.addedNotes=this.addedNotes.filter((e,s)=>!(!e.elems||!e.elems[0].id)&&!t.includes(e.elems[0].id)):this.addedNotes=null}addNoteId(t,e,s,i=0){const n=this.parseElemId(t);n&&this._addNoteMm(n.partIndex,n.mm,n.elemx+i,e,s,t,n.staff)}setHorpageMode(t){const e=t&&t.hidetitle;let s,i,n=!0;t&&t.noblank&&(n=!1),s=t&&t.w?t.w:this.parentw/4,i=t&&t.h?t.h:this.parenth;let o=0,a=0,r=0,l=0,h=0,c=0;t&&(t.margin&&(o=t.margin.left?t.margin.left:0,a=t.margin.right?t.margin.right:0),t.padding&&(r=t.padding.left||0,l=t.padding.right||0,s-=r+l,h=t.padding.top||0,c=t.padding.bottom||0,i-=h+c));const f=s/this.score.page.w;s=this.score.page.w/1,i=i/f/1,r/=f,l/=f,h/=f,c/=f,this.scale=1*f;const u=i/25;let p=0,m=0,d=0;const y=[];if(this.pages=[],!e){const t=this._creatHorPage(0,0,s+o+a,i);t.x+=r,t.y+=h,t.title=this.score.title,t.titlex=.48*s,t.titley=.4*i,this.pages.push(t)}for(const x of this.score.lines){const t=Object.assign({},x),e=this._getLineHeight(t);t.h=e.h,t.bottomMargin=e.bottomMargin,t.topMargin=e.topMargin,y.push(t)}for(let x=0;x<y.length;x++){const e=y[x];e.x+=this.score.page.x,m+=e.h+(e.topMargin||0)+(e.bottomMargin||0);let n=0;if(x<y.length-1){const t=y[x+1];n=t.h+(t.topMargin||0)+(t.bottomMargin||0)}const l=x-d+1;if(m+(l+.5)*u+n>i||x===y.length-1){this.pages.length>0&&x===y.length-1&&l<this.pages[this.pages.length-1].ls?p=Math.min(i/10,(i-m)/(l+1)):(p=(i-m)/(l+1),this.classroom&&(p-=2.4*this.lineh),p>e.distance&&l<4&&l===y.length&&(p=e.distance));let n=.7*p;t&&t.top?n=t.top:this.classroom&&(n+=2*this.lineh);for(let t=d;t<=x;t++){const e=y[t];e.y=n+(e.topMargin||0),e.distance=p,n+=p+e.h,e.topMargin&&e.bottomMargin&&(n+=e.topMargin+e.bottomMargin)}m=0;const c=this._creatHorPage(d,x-d+1,s+o+a,i);c.x+=r,c.y+=h,this.pages.push(c),d=x+1}}this.lines=y,n||(this.pages.push(this._creatHorPage(0,0,s,i)),this.pages.length<4&&this.pages.push(this._creatHorPage(0,0,s,i))),this.page={x:0,w:this.pages.length*(s+r+l),h:i+h+c}}showParts(t){this.showTrackIndexs=t,this._updateDisplayMode()}getPrefSize(t){return this.showTrackIndexs=t,this._onelinePrefHeight()}transposeKey(t,e){const s=this.lines,i=this.score.parts,n=e;for(const o of s){let s=0;for(const a of o.lineStaves){const r=i[a.parti];if(!r.measures)continue;s=n!==a.fifths?d[n+7]-d[a.fifths+7]:6;const l=10,h=(Math.abs(e)-Math.abs(t))*l,c=-h/r.measures[o.m1].w;for(let t=o.m1;t<o.m2&&!(t>=r.measures.length);t++){const e=r.measures[t];if(e.notes)for(const i of e.notes)if(t===o.m1&&(i.x+=c*i.x+h),i.elems)for(const t of i.elems){t.line+=s;let e=t.step+s;e>7?(t.octave+=1,e%=7):e<0&&(t.octave-=1,e=(7+e)%7),t.step=e}}a.fifths=n}}}nextMmNn(t,e){if(t<0||t>=this.measureInfos.length)return;if(e<this.measureInfos[t].notes.length-1)e+=1;else{if(!(t<this.measureInfos.length-1))return;t+=1,e=0}return{mm:t,nn:e}}posOf(t,e,s){if(0===this.measureInfos.length&&this.updateMeasurePos(),t<0||t>=this.measureInfos.length)return;const i=this.measureInfos[t],n={x:this.measurex(i),y:i.pagey+i.liney,height:i.h},o=i.notes;if(e<0)o.length>0?n.x+=o[0]+(i.w-o[0])*s:n.x+=i.w*s;else if(e<o.length){if(n.x+=o[e],s){let a;if(e<o.length-1)a=o[e+1]-o[e];else if(a=i.w-o[e],"oneline"===this.display&&t<this.measureInfos.length-1){const e=this.measureInfos[t+1].notes;e.length>0&&(a+=e[0])}n.x+=a*s}0===t&&this.jianpu&&(n.x-=20)}return n}getTouchPos(t,e){t/=this.scale,e/=this.scale;for(let s=0;s<this.measureInfos.length;s++){const i=this.measureInfos[s],n=this.measurex(i),o=i.liney+i.pagey-20;if(t>n&&t<n+i.w&&e>o&&e<o+i.h+20){const e=i.notes;for(let i=1;i<e.length;i++){if(t<e[i]+n-5)return{mm:s,nn:i-1}}return{mm:s,nn:e.length-1}}}}getMueasurePos(t){if(t<this.measureInfos.length){const e=this.measureInfos[t];return{x:this.measurex(e),y:e.liney,w:e.w,h:e.h}}}getNotePos(t){const e=this.parseElemId(t);if(e){const t=this.measureInfos[e.mm],s=this.scale*(t.liney+e.elemy-this.lineh/2);return{x:this.scale*(this.measurex(t)+e.elemx),y:s,w:this.lineh*this.scale,h:this.lineh*this.scale}}}getNoteInfo(t){const e=this.parseElemId(t);if(e){const s=this.measureInfos[e.mm],i=this.scale*(s.liney+e.elemy-this.lineh/2),n=this.scale*(this.measurex(s)+e.elemx),o=this.score.parts[e.partIndex].measures[e.mm];let a,r,l=0,h=!1,c=4;for(const e of o.notes){if(!e.elems)continue;let s=!1;for(const i of e.elems)if(i.id===t){s=!0,l=(4-i.line)/2,e.stem&&("up"===e.stem.type?h=!0:e.stem.up&&(h=e.stem.up)),c=e.type,i.acc&&"Natural"===i.acc.acc?r=0:i.alter&&(r=i.alter);break}if(s){if(e.arts)for(const s of e.arts)if("fingering"===s.type&&s.val){const o="fg_"+s.val+"_"+t;if(s.id===o){a={id:o,x:n+s.x,y:i+s.y,hide:s.hide,val:s.val};2===(e.hand||e.staff)&&(a.val=-a.val);break}}break}}const f={type:c,line:l,stemUp:h,pos:{x:n,y:i,w:this.lineh*this.scale,h:this.lineh*this.scale}};return a&&(f.finger=a),void 0!==r&&(f.alter=r),f}}showStaffHead(t,e){if("oneline"!==this.display)return;let s=0;const i=this.lines[0],n=t-(this.pages[0].x+i.x);for(let a=0;a<this.measureInfos.length;a++){const t=this.measureInfos[a];if(n<t.x)break;if(n>=t.x&&n<t.x+t.w){s=a;break}}if(s<1)return void(this.onelineHead.mm=0);this.onelineHead.x=n,e&&(this.onelineHead.color=e);if((this.onelineHead?this.onelineHead.mm:0)===s)return;const o=[];for(const a of this.lines){const t=[];for(const e of a.lineStaves){const i=this.score.parts[e.parti],n={},o=[];let a=0;for(let t=s;t>=0;t--){const s=i.measures[t];if(s.clefs){for(const t of s.clefs)if(!n[t.staff]&&(n[t.staff]=t.clef,o.push(Object.assign(Object.assign({},t),{x:0})),a+=1,a>=e.staves))break;if(a>=e.staves)break}}t.push({y:e.y,staves:e.staves,distances:e.distances,clefs:n,mclefs:o})}o.push({y:a.y,headStaves:t})}this.onelineHead.mm=s,this.onelineHead.time=this.prevTime(s),this.onelineHead.fifths=this.prevFifths(s),this.onelineHead.headLines=o}setNoteColor(e,s){for(const i of e){const e=this.parseElemId(i);e&&e.noteElem&&t.set(e.noteElem,"color",s)}}setStemColor(e,s){for(const i of e){const e=this.parseElemId(i);e&&e.note&&e.note.stem&&t.set(e.note.stem,"color",s)}}addFlag(t={}){if(!this.measureInfos)return;const e=t.mm||0;if("beats"===t.type){const s=this.measureInfos[e],i={beats:this.prevTime(e).beats,style:{color:t.color||"red",fontSize:t.fontSize||20}};s.flags=i}else if("meas"===t.type){const s=this.score.parts[0].measures.length;for(let i=0;i<s;i++){const s=this.measureInfos[i];e.includes(i)?s.flags=null:t.color?s.flags={beats:0,foreground:t.color}:s.flags=null}}else if("rect"===t.type){const s=t.color||"rgb(200, 200, 210)";let i,n=!1;for(const t of this.hiMeasures)if(t.mm===e){i=t,i.fill=s,n=!0;break}if(!n){const t=this.measureInfos[e];i={x:this.measurex(t),y:t.pagey+t.liney,width:t.w,height:t.h,mm:e,fill:s},this.hiMeasures.push(i)}}}clearFlag(t){if(this.measureInfos)if(void 0!==t)this.measureInfos[t].flags=null;else{for(const t of this.measureInfos)t.flags=null;this.hiMeasures=[]}}setDisplayMode(t,e){this.display=t,this.displayParam=e,e&&void 0!==e.tracks&&(this.showTrackIndexs=e.tracks),this._updateDisplayMode(),this.continues=null;const s=this.page.w+2;this.svgSize={width:s,height:this.page.h},"onepage"!==t&&"onepaged"!==t||(this.svgSize={width:"100%",height:"100%",viewBox:"0 0 "+s+" "+this.page.h})}getContinueItem(t){return this.continues||(this.continues=new c(this.score,this.lines,this.lineh,"oneline"===this.display)),this.continues.getContinueItem(t)}getMeasureInfos(t){const e=this.lines[t];return this.measureInfos.slice(e.m1,e.m2)}setJianpu(t,e){e?(this.jianpu=0,this.setPartJianpu(t,e)):this.jianpu=t,this.setJianpuStaffY(0===t),this.continues=null}changeKey(t){const e=this.lines[0].lineStaves;for(const s of e)s.clef&&"TAB"!==s.clef[1]&&(s.fifths=t)}setPartJianpu(e,s){const i=this.score.parts;for(let n=0;n<i.length;n++){const o=i[n],a=s.includes(n)?e:0;void 0===o.jianpu?t.set(o,"jianpu",a):o.jianpu=a}}setJianpuStaffY(t){var e,s,i,n,o;for(const a of this.lines){let r=0;for(let l=0;l<a.lineStaves.length;l++){const h=a.lineStaves[l];if(h.hidden)continue;if(t){h.y=(null===(e=h.margin)||void 0===e?void 0:e.yOrig)||0,l===a.lineStaves.length-1&&(a.h=h.y+(h.height||40));continue}const c=this.jianpu||this.score.parts[h.parti].jianpu,f=h.margin;0===r?h.y=0:(r+=c?(null===(s=f)||void 0===s?void 0:s.topJp)||20:(null===(i=f)||void 0===i?void 0:i.top)||20,h.y=r),r+=h.height||80,l===a.lineStaves.length-1&&(a.h=r),r+=c?(null===(n=f)||void 0===n?void 0:n.bottomJp)||20:(null===(o=f)||void 0===o?void 0:o.bottom)||20}}}prevTime(t){const e=this.score.parts[0];for(let s=t;s>=0;s--){const t=e.measures[s];if(t.time)return t.time}return{beats:4,beatu:4,sym:""}}prevFifths(t){const e=this.score.parts[0];for(let s=t;s>=0;s--){const t=e.measures[s];if(t.fifths)return t.fifths.fifths}return 0}_updateDisplayMode(){const t=this.display,e=this.displayParam;if("oneline"===t)this.setOnelineMode(e);else if("horpage"===t)this.setHorpageMode(e);else if("onepage"===t)this.setOnepageMode(e);else if("onepaged"===t){let t=document.documentElement.clientWidth;this.setOnepageMode({w:t,paged:!0})}if("horpage"===t||"oneline"===t){let t=-4*this.lineh,e=5*-this.lineh;const s=this.score.parts[0].measures[0];if(s.dirs)for(const i of s.dirs)if("metronome"===i.type){t=i.param.x-8*this.lineh,e=i.param.y+.5*this.lineh;break}this.jpFifthsPos={x:t,y:e}}else this.jpFifthsPos={x:(Math.abs(this.score.fifths)+5)*this.lineh,y:12*-this.lineh};this.updateMeasurePos()}updateMeasurePos(){const t=[],e=this.score.parts[0].measures;for(const s of this.pages)for(let i=s.l1;i<s.l1+s.ls;i++){const n=this.lines[i],o=this.page.x+n.x;let a=0;for(let i=n.m1;i<n.m2;i++){const r=e[i];let l=r.w,h=this.score.measInfo[i];if("oneline"===this.display&&r.keyw){l-=r.keyw;const t=[];for(const e of h)t.push(e-r.keyw);h=t}t.push({pagex:s.x,pagey:s.y,x:a,w:l,h:n.h,linex:o,liney:n.y,mm:i,notes:h,info:r,flags:null}),a+=l}}this.measureInfos=t}measurex(t){return t.x+t.linex+t.pagex}parseElemId(t){const e=t.split("_");let s=0,i=1;e.length>3&&(s=Number(e[i]),i+=1);const n=Number(e[i]),o=this.score.parts[s];if(!o)return;const a=o.measures[n];let r,l,h=0,c=0,f=0;for(const u of a.notes)if(u.elems){for(const e of u.elems)e.id===t&&(h=e.staff||u.staff,c=u.x,f=e.y||0,l=e,r=u);if(h)break}return{partIndex:s,mm:n,staff:h,elemx:c,elemy:f,note:r,noteElem:l}}_addNoteMm(t,e,s,i,n,o,a){const r=new h;r.partIndex=t,r.mm=e,r.x=s,r.staff=a||1;const l=h.newElem();l.val=i,l.color=n,l.id=o,r.elems=[l],this.addedNotes?this.addedNotes=[...this.addedNotes,r]:this.addedNotes=[r]}setOnepageTitle(t,e,s){this.score.title&&(t.title=this.score.title,t.titlex=(e.x+e.w)/2,t.titley=10*this.lineh)}setOnepageMode(t){let e;e=t&&t.w?t.w:document.documentElement.clientWidth;const s=t&&t.paged;this.display=s?"onepaged":"onepage",this.displayParam=t;let i=!1;const n=Object.assign({},this.score.page);if(s){n.h=this.score.page.w*y;for(const t of this.score.lines)if(t.newpage){i=!0;break}}this.scale=e/n.w,e=n.w;let o=n.h;this.page=n;const a=this.score.lines,r=[];this.pages=[];let l=0,h=this.score.page.y,c=null,f=10*this.lineh,u=h+30;this.score.title&&(this.score.title.subtitle&&(u+=30*this.score.title.subtitle.split("\n").length),this.score.title.composer&&(u+=30*this.score.title.composer.split("\n").length));for(let p=0;p<a.length;p++){const t=Object.assign({},a[p]),m=this._getLineHeight(t);if(t.h=m.h,t.bottomMargin=m.bottomMargin,t.topMargin=m.topMargin,t.x+=n.x,r.push(t),!s){0===p&&(h+=u),h+=m.topMargin,t.y=h,h+=t.h+m.bottomMargin+3*this.lineh,p===a.length-1&&(o=h+t.distance,c=this.createPage(e,o),c.x=0,c.ls=a.length,this.setOnepageTitle(c,t,r[0].y),this.pages.push(c));continue}if(0===p&&t.top&&(f=t.top),this.pages.length>0){const e=this.pages[this.pages.length-1];t.y-=e.y+e.h}let d=0===p||t.newpage;if(!d&&!i&&h+t.h>o&&(d=!0),d){c&&(c.ls=p-l,this.pages.push(c));const s=this.pages.length;c=this.createPage(e,o),c.x=0,c.l1=p,c.y=s*o,0===s&&this.setOnepageTitle(c,t,f),h=this.score.page.y,l=p,t.top?h+=t.top:h+=10*this.lineh}t.y=h,h+=t.h+m.topMargin+m.bottomMargin+5*this.lineh,p===a.length-1&&c&&(c.ls=p-l+1,this.pages.push(c))}n.x=0,n.h=this.pages.length*o,s&&(n.h-=5+this.pages.length),this.lines=r,s&&this.rearrangePage(f-20)}rearrangePage(t){for(const e of this.pages){let s=0;for(let t=e.l1;t<e.l1+e.ls;t++){const e=this.lines[t];s+=e.h+(e.topMargin||0)+(e.bottomMargin||0)}let i=e.h-s;e.title&&(i-=t);let n=i/(e.ls+1.5);n>e.h/10?n=e.h/10:n<0&&(n=0,t=e.h-s);let o=n;e.title&&(o+=t);for(let t=e.l1;t<e.l1+e.ls;t++){const e=this.lines[t];o+=e.topMargin||0,e.y=o,o+=e.h+(e.bottomMargin||0)+n}}}createPage(t,e){return{x:0,y:0,w:t,h:e,l1:0,ls:0}}_creatHorPage(t,e,s,i){const n=this.pages.length,o=this.createPage(s,i);return o.l1=t,o.ls=e,o.x=n*s,o.fill=n%2==0?"#faf0ea":"#f0fdf0",o}_onelinePrefHeight(){const t=this.score.lines;let e=0;for(const i of t){const t=this._getLineHeight(i).h;t>e&&(e=t)}let s=.8*e;return s<12*this.lineh?s=12*this.lineh:s>24*this.lineh&&(s=24*this.lineh),e+=2*s,e}setOnelineMode(t){const e=t&&t.hidetitle;let s;s=t&&t.h?t.h:this.parenth;const i=this.score.lines,n=i[0],o=[];for(const f of n.lineStaves){const t=Object.assign({},f);t.margin=void 0,t.distances=[...f.distances],o.push(t)}const a={x:0,y:0,w:0,h:0,m1:0,m2:i[i.length-1].m2,lineStaves:o,oneline:!0,distance:0};let r=0;const l=this.score.parts[0].measures;for(const f of i){for(let e=0;e<f.lineStaves.length;e++){const t=f.lineStaves[e],s=o[e];if(t.distances.length>s.distances.length)s.distances=[...t.distances];else{let e=4*this.lineh;for(let i=0;i<t.distances.length;i++)s.distances[i]<t.distances[i]&&(s.distances[i]=t.distances[i]),i>0&&(e+=s.distances[i]+4*this.lineh);s.height=e}}let t=0;for(let e=f.m1;e<f.m2;e++){const s=l[e];s.keyw&&(t-=s.keyw),t+=s.w}r+=t}a.h=this._getLineHeight(a).h;let h=.8*a.h;h<12*this.lineh?h=12*this.lineh:h>24*this.lineh&&(h=24*this.lineh),this.scale=s/(2*h+a.h),this.scale>1&&(this.scale=1),a.x=e?100:768,a.y=t&&t.top?t.top:h,a.w=r,this.lines=[a],this.page={x:0,y:0},this.page.w=r+this.page.x+a.x+3456/this.scale,this.page.h=s/this.scale;const c=this.createPage(this.page.w,this.page.h);c.ls=1,e||(c.title=this.score.title,c.titlex=.4*a.x,c.titley=.4*this.page.h),this.pages=[c],f.calcLineStaffRange(this.score,this.lines)}_getLineHeight(t){const e=this.showTrackIndexs;let s=0,i=0,n=0,o=null,a=null;for(let r=0;r<t.lineStaves.length;r++){const l=t.lineStaves[r],h=l.staves||1;if(!e||e.includes(n)||h>1&&e.includes(n+1)){l.hidden=!1,l.y=i,l.margin&&(l.margin.yOrig=i);for(let e=1;e<=h;e++){const n=l.details?l.details[e]:void 0;if(n){if(n.hide&&"oneline"!==this.display)continue;n.lines&&n.lines>5&&(i+=this.lineh)}let o=0;e<l.distances.length?o=l.distances[e]:e===h&&r<t.lineStaves.length-1&&(o=t.lineStaves[r+1].distances[0]),i+=4*this.lineh+o,s=o}i===l.y&&(l.hidden=!0)}else l.hidden=!0;n+=h,l.hidden||(o||(o=l),a=l)}i-=s;return{h:i,topMargin:o&&o.margin?o.margin.top:20,bottomMargin:a&&a.margin?a.margin.bottom:20}}}class g{constructor(t,e){this.maintitles=t.title?t.title.split("\n"):void 0,this.titleSize=t.t&&t.t.size?t.t.size*g.scale:4*e,this.subtitles=t.subtitle?t.subtitle.split("\n"):void 0,this.subtitleSize=t.s&&t.s.size?t.s.size*g.scale:2.7*e,this.comps=t.composer?t.composer.split("\n"):void 0,this.compSize=t.c&&t.c.size?t.c.size*g.scale:2.3*e,this.instructions=t.instruction?t.instruction.split("\n"):void 0,this.instSize=t.c&&t.c.size?t.c.size*g.scale:2.3*e,this.comps?this.instructions&&this.comps.unshift(...this.instructions):this.comps=this.instructions,this.instructions=void 0}}g.scale=3.8;var v={name:"SvgTitle",props:{x:Number,y:Number,pagex:{type:Number,default:0},lineh:Number,title:Object},data:function(){return{obj:new g(this.title,this.lineh)}},computed:{titley:function(){var t=this.y;return this.obj.maintitles&&this.obj.maintitles.length>1&&(t-=this.obj.titleSize*(this.obj.maintitles.length-1)),t},subtitley:function(){var t=this.titley+3*this.lineh;return this.obj.maintitles&&(t+=2*this.obj.maintitles.length*this.lineh),t}}};function _(t,e,s,i,n,o,a,r,l,h){"boolean"!=typeof a&&(l=r,r=a,a=!1);const c="function"==typeof s?s.options:s;let f;if(t&&t.render&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),i&&(c._scopeId=i),o?(f=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=f):e&&(f=a?function(t){e.call(this,h(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,r(t))}),f)if(c.functional){const t=c.render;c.render=function(e,s){return f.call(s),t(e,s)}}else{const t=c.beforeCreate;c.beforeCreate=t?[].concat(t,f):[f]}return s}const b="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function N(t){return(t,e)=>function(t,e){const s=b?e.media||"default":t,i=S[s]||(S[s]={ids:new Set,styles:[]});if(!i.ids.has(t)){i.ids.add(t);let s=e.source;if(e.map&&(s+="\n/*# sourceURL="+e.map.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",e.media&&i.element.setAttribute("media",e.media),void 0===k&&(k=document.head||document.getElementsByTagName("head")[0]),k.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(s),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{const t=i.ids.size-1,e=document.createTextNode(s),n=i.element.childNodes;n[t]&&i.element.removeChild(n[t]),n.length?i.element.insertBefore(e,n[t]):i.element.appendChild(e)}}}(t,e)}let k;const S={};const w=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{staticClass:"title"},[t.obj.maintitles?t._l(t.obj.maintitles,(function(e,i){return s("text",{key:"t"+i,attrs:{x:t.pagex+t.x,y:t.titley+1.15*i*t.obj.titleSize,"font-size":t.obj.titleSize,"text-anchor":"middle"}},[t._v(t._s(e))])})):t._e(),t._v(" "),t.obj.subtitles?t._l(t.obj.subtitles,(function(e,i){return s("text",{key:"s"+i,attrs:{x:t.pagex+t.x,y:t.subtitley+1.15*i*t.obj.subtitleSize,"font-size":t.obj.subtitleSize,"text-anchor":"middle"}},[t._v(t._s(e))])})):t._e(),t._v(" "),t.obj.comps?t._l(t.obj.comps,(function(e,i){return s("text",{key:"c"+i,attrs:{x:t.pagex+2*t.x,y:t.titley+t.obj.titleSize/2+1.15*i*t.obj.compSize-1.15*t.obj.comps.length*t.obj.compSize/2-t.obj.compSize/2,"font-size":t.obj.compSize,"text-anchor":"end"}},[t._v(t._s(e))])})):t._e()],2)},staticRenderFns:[]},(function(t){t&&t("data-v-9ea6a786_0",{source:".title[data-v-9ea6a786]{font-family:Times New Roman,Times,serif;white-space:pre}",map:void 0,media:void 0})}),v,"data-v-9ea6a786",!1,void 0,!1,N,void 0,void 0),O={Group:"ğ",ACC_Sharp:"ġ",ACC_Flat:"Ģ",ACC_Natural:"ģ",ACC_DoubleSharp:"Ĥ",ACC_DoubleFlat:"ĥ",ACC_Sharp_Caution:"Ħ",ACC_Flat_Caution:"ħ",ACC_Natural_Caution:"Ĩ",ACC_DoubleSharp_Caution:"ĩ",ACC_DoubleFlat_Caution:"Ī",ACC_Small_SHARP:"ī",ACC_Small_FLAT:"Ĭ",ACC_Small_STOP:"ĭ",ACC_Small_DOUBLE_SHARP:"Į",ACC_Small_DOUBLE_FLAT:"į",BracketUp:"Ļ",BracketDown:"ļ",NOTE_QUADRUPLE_WHOLE:"ũ",NOTE_DOUBLE_WHOLE:"ŀ",NOTE_1:"Ł",NOTE_2_UP:"ł",NOTE_4_UP:"Ń",NOTE_8_UP:"ń",NOTE_16_UP:"Ņ",NOTE_32_UP:"ņ",NOTE_64_UP:"Ň",NOTE_128_UP:"ň",TAIL_8_UP:"ŉ",TAIL_16_UP:"Ŋ",TAIL_32_UP:"ŋ",TAIL_64_UP:"Ō",TAIL_128_UP:"ō",NOTE_x:"Ŏ",NOTE_diamond:"ŏ",NOTE_diamond_n:"ŏ",NOTE_slash:"Ő","NOTE_circle-x":"ő",NOTE_2_DOWN:"Œ",NOTE_4_DOWN:"œ",NOTE_8_DOWN:"Ŕ",NOTE_16_DOWN:"ŕ",NOTE_32_DOWN:"Ŗ",NOTE_64_DOWN:"ŗ",NOTE_128_DOWN:"Ř",TAIL_8_DOWN:"ř",TAIL_16_DOWN:"Ś",TAIL_32_DOWN:"ś",TAIL_64_DOWN:"Ŝ",TAIL_128_DOWN:"ŝ",NOTE_do:"Ű",NOTE_re:"ű",NOTE_mi:"Ų",NOTE_diamond_f:"Ų",NOTE_fa:"ų",NOTE_4:"Ŵ",NOTE_so:"Ŵ",NOTE_la:"ŵ",NOTE_square_f:"ŵ",NOTE_ti:"Ŷ",NOTE_Diamond:"ź",NOTE_2:"ż",NOTE_square:"Ž",Clef_Treble:"ƀ",Clef_Bass:"Ɓ",Clef_Middle:"Ƃ",Clef_Percussion:"ƃ",Clef_Treble8va:"ƅ",Clef_Treble8vb:"Ɔ",Clef_Bass8va:"Ƈ",Clef_Bass8vb:"ƈ",Clef_TAB:"Ɖ",Time_common:"Ɗ",Time_cut:"Ƌ",p:"Ɛ",pp:"Ƒ",ppp:"ƒ",pppp:"Ɠ",mp:"Ɣ",f:"ƕ",ff:"Ɩ",fff:"Ɨ",ffff:"Ƙ",mf:"ƙ",sf:"ƚ",fz:"ƛ",sfz:"Ɯ",fp:"Ɲ","ART_trill-mark":"Ơ",ART_WAVE_Hor:"Ƣ","ART_inverted-mordent":"ƣ",ART_mordent:"Ƥ",ART_MORDENT_LONG:"ƥ",ART_turn:"Ʀ",TREMOLO_8:"ƨ",TREMOLO_16:"Ʃ",TREMOLO_32:"ƪ",TREMOLO_64:"ƫ",ART_WAVE_Ver:"Ƭ",segno:"ư",coda:"Ʊ",ART_FERMATA_UP:"Ʋ",ART_FERMATA_DOWN:"Ƴ",OCTAVE_8va:"ƴ",OCTAVE_8vb:"Ƶ",OCTAVE_15ma:"ƶ",ART_breath_mark:"ƹ",ART_caesura:"ƺ",ART_accent:"ǀ",ART_Accent_dot_up:"ǁ","ART_strong-accent":"đ",ART_scoop:"Ē",ART_strong_accent_down:"Ǆ",ART_SFORZANDO_DOWN:"ǅ",ART_staccatissimo:"Đ",ART_spiccato:"Đ",ART_staccatoJianpu:"ǆ",ART_staccato:"Ǉ",ART_tenuto:"ǈ",ART_harmonic:"ǉ",ART_Add:"ǋ",ART_BOWUP:"ǌ",ART_BOWDOWN:"Ǎ",ART_BOWUP_BELOW:"ǎ",ART_BOWDOWN_BELOW:"Ǐ",ART_PEDAL_DOWN:"ǐ",ART_PEDAL_UP:"Ǒ",ART_A:"ǒ",ART_U:"Ǔ",Round_Num1:"ǜ",Round_Num2:"ǝ",Round_Num3:"Ǟ",Round_Num4:"ǟ",Round_Num5:"Ǡ",Round_Num6:"ǡ",Round_Num7:"Ǣ",Round_Num8:"ǣ",Italic_Num0:"ǰ",Italic_Num1:"Ǳ",Italic_Num2:"ǲ",Italic_Num3:"ǳ",Italic_Num4:"Ǵ",Italic_Num5:"ǵ",Italic_Num6:"Ƕ",Italic_Num7:"Ƿ",Italic_Num8:"Ǹ",Italic_Num9:"ǹ"};class I{}I.num=["İ","ı","Ĳ","ĳ","Ĵ","ĵ","Ķ","ķ","ĸ","Ĺ"],I.rest={1:"š",2:"Ţ",4:"ţ",8:"Ť",16:"ť",32:"Ŧ",64:"ŧ",128:"Ũ"};const j=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.type&&t.y1<t.y2&&t.y1>=0?s("g",[t._l(t.brackets,(function(e,i){return["text"==e.type?s("text",t._b({key:i},"text",e.param,!1),[t._v(t._s(e.text))]):t._e(),t._v(" "),"line"==e.type?s("line",t._b({key:i,attrs:{stroke:"black"}},"line",e.param,!1)):t._e(),t._v(" "),"rect"==e.type?s("rect",t._b({key:i,staticStyle:{fill:"rgba(0,0,0,0)","stroke-width":"1",stroke:"black"}},"rect",e.param,!1)):t._e()]}))],2):t._e()},staticRenderFns:[]},void 0,{name:"SvgGroup",props:{x:Number,y1:Number,y2:Number,type:String,lineh:Number},computed:{brackets:function(){var t=[],e=this.y2-this.y1,s=1.8*this.lineh;if("bracket"===this.type){var i=.29*s,n=this.x+.6*i;t.push({type:"line",param:{x1:n,x2:n,y1:this.y1,y2:this.y2,"stroke-width":i}}),t.push({type:"text",text:O.BracketUp,param:{x:n-i/2,y:this.y1,"font-size":s}}),t.push({type:"text",text:O.BracketDown,param:{x:n-i/2,y:this.y2,"font-size":s}})}else if("square"===this.type){var o=1.4*this.lineh,a=this.x-o+this.lineh;t.push({type:"rect",param:{x:a,y:this.y1,width:o,height:e}})}else{s=2.96*e;var r=this.x-s/this.lineh/13;t.push({type:"text",param:{x:r,y:this.y2,"font-size":s},text:O.Group})}return t}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const T=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",t._b({},"g",t.style,!1),t._l(t.lines,(function(e){return s("line",{key:e,attrs:{x1:t.x,x2:t.x+t.width,y1:t.top+(e-1)*t.seg,y2:t.top+(e-1)*t.seg}})})),0)},staticRenderFns:[]},void 0,{name:"SvgFiveLine",props:{x:Number,y:Number,width:Number,lines:{type:Number,default:5},lineh:Number,attr:Object},data:function(){var t=this.y,e=this.lineh;return 1===this.lines?t+=2*this.lineh:2===this.lines?(t+=1*this.lineh,e=2*this.lineh):3===this.lines?t+=1*this.lineh:4===this.lines&&(t+=0*this.lineh),{top:t,seg:e}},computed:{style:function(){var t={stroke:"black"};return this.attr&&(this.attr.color&&(t.stroke=this.attr.color),this.attr.opacity&&(t.style="opacity: "+this.attr.opacity+";")),t}}},void 0,!1,void 0,!1,void 0,void 0,void 0);class M{static getGlyphs(t){return t.jianpu?M.getJianpuText(t.fifths,t.lineh):M.getWuxianpuText(t)}static getJianpuText(t,e){const s=2.5*e,i=[{text:this.jianpuhao[t+10],param:{x:0,y:0,"font-size":s}}];if(t<-8){const t={x:1.1*s,y:-e,"font-size":.6*s};i.push({text:O.ACC_DoubleFlat,param:t})}else if(t<-1){const t={x:1.2*s,y:-e,"font-size":.6*s};i.push({text:O.ACC_Flat,param:t})}else if(t>5){const t={x:1.1*s,y:1.5*-e,"font-size":.5*s};i.push({text:O.ACC_Sharp,param:t})}return i}static getWuxianpuText(t){const e=t.fifths>0?O.ACC_Sharp:O.ACC_Flat,s=[],i=Math.abs(t.fifths),n=t.staves||1;for(let o=1;o<=n;o++){const n=t.staffOffset[o-1];if(n<0)continue;let a=t.clef[""+o];if("Treble8va"===a)a=l.Treble;else if("Percussion"===a||"TAB"===a)continue;if(!this.sharpLines[a]){console.log("Error lines for fifths:"+t.fifths+" clef:"+a);continue}let r=0;if(t.cancel){const e=t.cancel>0?this.sharpLines[a]:this.flatLines[a],o=Math.abs(t.cancel);for(let a=t.fifths*t.cancel<0?0:i;a<o;a++){const i=n+2*t.lineh-e[a]*t.lineh/2;s.push({text:O.ACC_Natural,param:{x:r,y:i}}),r+=t.lineh}}if(t.fifths){const l=t.fifths>0?this.sharpLines[a]:this.flatLines[a],h="track"+(t.trackIndex+o-1);for(let o=0;o<i;o++){const i=n+2*t.lineh-l[o]*t.lineh/2;s.push({text:e,param:{x:r,y:i,class:h}}),r+=t.lineh}}}return s}}M.sharpLines={Treble:[4,1,5,2,-1,3,0],Bass:[2,-1,3,0,-3,1,-2],Alto:[3,0,4,1,-2,2,-1],UpAlto:[-2,2,-1,3,0,4,1],DownDownAlto:[-1,-4,0,-3,1,-2,-5],DownAlto:[2,-2,3,-1,-4,0,-3],UpUpAlto:[0,4,1,5,2,6,3]},M.flatLines={Treble:[0,3,-1,2,-2,1,-3],Bass:[-2,1,-3,0,-4,-1,-5],Alto:[-1,2,-2,1,-3,0,3],UpAlto:[1,4,0,3,-1,2,-2],DownDownAlto:[-5,-2,1,-3,0,-4,-1],DownAlto:[-3,0,-4,-2,3,-2,2],UpUpAlto:[3,6,2,5,1,4,0]},M.jianpuhao=["1=   E","1=   B","1= F","1= C","1= G","1= D","1= A","1= E","1= B","1= F","1= C","1= G","1= D","1= A","1= E","1= B","1= F","1= C","1= G","1= D","1= A"];const A=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.x+","+t.y+")","font-size":t.jianpu?1.4*t.lineh:2*t.lineh}},t._l(t.glyphs,(function(e,i){return s("text",t._b({key:"g"+i},"text",e.param,!1),[t._v(t._s(e.text))])})),0)},staticRenderFns:[]},void 0,{name:"SvgFifths",props:{fifths:Number,cancel:Number,clef:Object,lineh:Number,y:{type:Number,default:0},x:Number,staffOffset:Array,staves:{type:Number,default:1},jianpu:Boolean,trackIndex:Number},computed:{glyphs:function(){return M.getGlyphs(this._props)}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const C=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.time?s("g",[t._l(t.glyphs,(function(e,i){return["line"==e.type?s("line",t._b({key:i},"line",e.param,!1)):s("text",t._b({key:i},"text",e.param,!1),[t._v(t._s(e.text))])]}))],2):t._e()},staticRenderFns:[]},void 0,{name:"SvgTime",props:{time:Object,x:Number,basey:Number,lineh:Number,staffOffset:Array,staves:Number,jianpu:Boolean,trackIndex:Number},computed:{glyphs:function(){return class{static timeGlyphs(t){const e=[],s=t.jianpu?2.5*t.lineh:2*t.lineh,i=t.staves||1,n=this.glyphsOfNum(t.time.beats,t.jianpu),o=this.glyphsOfNum(t.time.beatu,t.jianpu);for(let a=1;a<=i;a++){let i=t.staffOffset?t.staffOffset[a-1]:0;if(i<0)continue;t.basey?i+=t.basey:t.jianpu&&(i-=50);const r="track"+(t.trackIndex+a-1);if("cut"!==t.time.sym&&"common"!==t.time.sym||t.jianpu)this.insertBeat(e,n,s,r,t.x,i+.5*s),this.insertBeat(e,o,s,r,t.x,i+1.5*s);else{const n={x:t.x,y:i+2*t.lineh,"font-size":s,class:r};e.push({text:O["Time_"+t.time.sym],param:n})}if(t.jianpu){const n=i+.65*s;let o=.6*s,a=t.x;t.time.beats>9&&(o+=.2*s,a-=.2*s);const r={x1:a,y1:n,x2:t.x+o,y2:n,stroke:"black"};e.push({type:"line",param:r})}}return e}static glyphsOfNum(t,e){if(e)return[t];{let e=[];if(t>=10){const s=Math.floor(t/10),i=t%10;e.push(I.num[s]),e.push(I.num[i])}else e=[I.num[t]];return e}}static insertBeat(t,e,s,i,n,o){let a=e.length<2?n:n-.3*s;for(const r of e){const e={x:a,y:o,"font-size":s,class:i};t.push({text:r,param:e}),a+=.7*s}}}.timeGlyphs(this._props)}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const P=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+(t.notex+t.x1)+","+(t.notey+t.y1)+")","font-size":t.fontSize}},t._l(t.items,(function(e,i){return s("text",t._b({key:"w"+i},"text",e.param,!1),[t._v(t._s(e.text))])})),0)},staticRenderFns:[]},void 0,{name:"NoteWaveline",props:{lineh:Number,x1:Number,y1:Number,x2:Number,y2:Number,contx:Number,conty:Number,notex:Number,notey:Number},data:function(){return{fontSize:1.5*(1.1*this.lineh)}},computed:{top:function(){return(this.y1<this.y2?this.y1:this.y2)+this.notey},items:function(){var t=[],e=1.1*this.lineh,s=this.contx||this.x2,i=this.conty||this.y2;if(this.x1===s||void 0===s)for(var n=Math.abs(this.y1-i)/e,o=10,a=0;a<n;a++)t.push({text:O.ART_WAVE_Ver,param:{y:o}}),o+=e;else if(this.y1===i||void 0===i)for(var r=Math.abs(this.x1-s)/e,l=0,h=0;h<r;h++)t.push({text:O.ART_WAVE_Hor,param:{x:l,y:0}}),l+=e;else for(var c=(i-this.y1)/(s-this.x1),f=Math.atan(c),u=e*Math.cos(f),p=e*Math.sin(f),m=(s-this.x1)/Math.cos(f)/e,d=0,y=0,x=180*f/3.14,g=0;g<m;g++)t.push({text:O.ART_WAVE_Hor,param:{x:d,y:y,rotate:x}}),d+=u,y+=p;return t}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const E=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.notex+","+t.notey+")"}},[t.jianpu?[s("path",{staticClass:"slurline",attrs:{d:t.slurPath}})]:t.bracket?[s("line",t._b({attrs:{stroke:"black"}},"line",t.items.line1,!1)),t._v(" "),s("line",t._b({attrs:{stroke:"black"}},"line",t.items.line2,!1)),t._v(" "),s("line",t._b({attrs:{stroke:"black"}},"line",t.items.line3,!1)),t._v(" "),s("line",t._b({attrs:{stroke:"black"}},"line",t.items.line4,!1))]:t._e(),t._v(" "),s("text",{staticClass:"num",attrs:{x:t.items.textx,y:t.jianpu?t.items.texty-10:t.items.texty}},[t._v(t._s(t.value))])],2)},staticRenderFns:[]},(function(t){t&&t("data-v-fe23292a_0",{source:".slurline[data-v-fe23292a]{stroke-width:.5;fill:#000;stroke:#000}.num[data-v-fe23292a]{fill:#000;font-style:italic;font-size:16px}",map:void 0,media:void 0})}),{name:"NoteTuplet",props:{x1:Number,y1:Number,x2:Number,y2:Number,up:Boolean,value:Number,bracket:Boolean,notex:Number,notey:Number,staff2:Number,jianpu:Boolean},data:function(){return{items:this.getItems()}},computed:{slurPath:function(){var t={x1:this.x1,x2:this.x2+8,y1:this.y1,y2:this.y2},e=.15*(this.x2-this.x1);t.cp1x=t.x1+e,t.cp2x=t.x2-e,t.cp1y=t.y1-e,t.cp2y=t.y2-e;var s="C".concat(t.cp2x,",").concat(t.cp2y+1," ").concat(t.cp1x,",").concat(t.cp1y+2," ").concat(t.x1,",").concat(t.y1);return"M".concat(t.x1,",").concat(t.y1," C").concat(t.cp1x,",").concat(t.cp1y," ").concat(t.cp2x,",").concat(t.cp2y," ").concat(t.x2,",").concat(t.y2," ").concat(s)}},methods:{getItems:function(){var t=this.up?4:-4,e=this.x1,s=this.x2+8,i=this.y1-t,n=this.y2-t,o=(n-i)/(s-e),a=6;this.value>9&&(a=10);var r=(e+s)/2,l=r-a,h=r+a,c=o*(l-e)+i,f=o*(h-e)+i,u=(i+n)/2;return this.bracket?u+=this.up?4:6:(l=r-a/2,this.up?u+=4:(u+=12,this.staff2&&(u+=10))),{line1:{x1:e,x2:e,y1:i,y2:i+t},line2:{x1:e,x2:l,y1:i,y2:c},line3:{x1:h,x2:s,y1:f,y2:n},line4:{x1:s,x2:s,y1:n,y2:n+t},textx:l,texty:u}}}},"data-v-fe23292a",!1,void 0,!1,N,void 0,void 0);class F{static slurPosJianpu(t,e){let s,i=t.x1+.8*e;s=void 0!==t.contx?t.contx:t.x2+e/4,s<=i+e&&(i=s-e);let n=(s-i)/5;n>4*e?n=2*e:n>e?n=e:n<.7*e&&(n=.7*e);return{x1:i,y1:0,cp1x:i,cp1y:0-1*n,x2:s,y2:0,cp2x:s,cp2y:0-1*n}}static slurPathJianpu(t){const e=t.y1-t.cp1y,s=1.2*e,i=e/3;return`M${t.x1},${t.y1} q${i},-${e},${s},-${e} l${t.x2-t.x1-2*s},0 q${s-i},0,${s},${e}`}static slurPos(t,e,s,i,n){let o=t.x1,a=void 0!==t.contx?t.contx:t.x2;const r=t.y1;let l,h,c,f,u=void 0!==t.conty?t.conty:t.y2;if(t.staff2&&(u+=t.staff2*(n+4*i)),0===o&&(o+=i/2,e&&t.up?o+=.7*i:e||t.up||(a-=.2*i)),a<o+1.5*i&&(o=a-1.5*i),t.bx1&&t.by1&&(t.bx2||t.contbx)){if(l=o+t.bx1,h=r+t.by1,t.contbx&&t.contby?(c=a+t.contbx,f=u+t.contby):(c=a+(t.bx2||0),f=u+(t.by2||0)),l>c){const e=(a-o)/4;l=o+e,c=a-e,t.up?(h=r-e,f=u-e):(h=r+e,f=u+e)}}else{o+=.5*i,a+=.2*i;const e=Math.sqrt((u-r)*(u-r)+(a-o)*(a-o)),s=Math.atan((u-r)/(a-o));let n=e/4,p=.6;e>900?(n=e/10,p=.5):e>400?(n=e/8,p=.5):e>100?(n=e/5,p=.5):n=e/3,t.up?(l=o+n*Math.cos(s-p),h=r+n*Math.sin(s-p),c=a-n*Math.cos(s+p),f=u-n*Math.sin(s+p)):(l=o+n*Math.cos(s+p),h=r+n*Math.sin(s+p),c=a-n*Math.cos(s-p),f=u-n*Math.sin(s-p))}return{x1:o,y1:r,cp1x:l,cp1y:h,x2:a,y2:u,cp2x:c,cp2y:f}}static slurPath(t){const e=`C${t.cp2x},${t.cp2y+1} ${t.cp1x},${t.cp1y+2} ${t.x1},${t.y1}`;return`M${t.x1},${t.y1} C${t.cp1x},${t.cp1y} ${t.cp2x},${t.cp2y} ${t.x2},${t.y2} ${e}`}}const L=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.notex+","+t.notey+")"}},[t.tieText?s("text",{attrs:{x:(t.pos.x1+t.pos.x2)/2-5,y:t.pos.y1-5}},[t._v(t._s(t.tieText))]):t._e(),t._v(" "),s("path",{class:t.jianpu?"slurlinejp":"slurline",attrs:{d:t.path}})])},staticRenderFns:[]},(function(t){t&&t("data-v-35a9c118_0",{source:".slurline[data-v-35a9c118]{stroke-width:.5;fill:#000;stroke:#000}.slurlinejp[data-v-35a9c118]{stroke-width:2;fill:transparent;stroke:#000}",map:void 0,media:void 0})}),{name:"NoteSlur",props:{notex:{type:Number,required:!0},notey:{type:Number,required:!0},slur:Object,stemup:Boolean,lineh:Number,staffDistance:Number,jianpu:Boolean,tied:Boolean,tieText:String},computed:{pos:function(){var t;return t=this.jianpu?F.slurPosJianpu(this.slur,this.lineh):F.slurPos(this.slur,this.stemup,this.tied,this.lineh,this.staffDistance),t},path:function(){var t;return t=this.jianpu?F.slurPathJianpu(this.pos):F.slurPath(this.pos),t}}},"data-v-35a9c118",!1,void 0,!1,N,void 0,void 0);const R=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.notex+","+t.notey+")"}},[s("line",{attrs:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:"black"}}),t._v(" "),t.text?s("text",{attrs:{x:(t.x1+t.x2)/2-20,y:(t.y1+t.y2)/2-10,fill:"black"}},[t._v(t._s(t.text))]):t._e()])},staticRenderFns:[]},void 0,{name:"NoteSlide",props:{x1:Number,y1:Number,x2:Number,y2:Number,up:Boolean,text:String,glissando:Boolean,notex:Number,notey:Number}},void 0,!1,void 0,!1,void 0,void 0,void 0);const D=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",t._l(t.num,(function(e){return s("line",{key:e,attrs:{x1:t.notex+t.x1+10,x2:t.notex+t.x2-3,y1:t.notey-15+t.y1+7*e,y2:t.notey-15+t.y2+7*e,"stroke-width":"5",stroke:"black"}})})),0)},staticRenderFns:[]},void 0,{name:"NoteTremolo",props:{x1:Number,y1:Number,x2:Number,y2:Number,notex:Number,notey:Number,num:Number}},void 0,!1,void 0,!1,void 0,void 0,void 0);const z=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{staticClass:"lyric"},t._l(t.lyrics,(function(e,i){return s("text",t._b({key:i,attrs:{x:e.param.x-t.x+8,y:e.param.y+t.y,"text-anchor":"middle"}},"text",e.param,!1),[t._v("\n        "+t._s("begin"==e.syllabic||"middle"==e.syllabic?e.text+" -":e.text)+"\n    ")])})),0)},staticRenderFns:[]},(function(t){t&&t("data-v-6ba72c00_0",{source:".lyric[data-v-6ba72c00]{font-size:20px}",map:void 0,media:void 0})}),{name:"NoteLyrics",props:{x:Number,y:Number,lyrics:Array}},"data-v-6ba72c00",!1,void 0,!1,N,void 0,void 0);class B{constructor(t){this.type=t}static textItem(t,e,s,i,n,o){const a={x:t,y:e};return i&&(a["font-size"]=i),n&&(a.fill=n),o&&(a.id=o),{type:"text",text:s,param:a}}static lineItem(t,e,s,i,n,o){const a={x1:t,y1:e,x2:s,y2:i,stroke:"black"};return n&&1!==n&&(a["stroke-width"]=n),o&&(a.stroke=o),{type:"line",param:a}}static rectItem(t,e,s,i,n,o){const a={x:t,y:e,width:s,height:i};return n&&(a.fill=n),o&&(a.rx=o,a.ry=o),{type:"rect",param:a}}static circleItem(t,e,s,i){const n={cx:t,cy:e,r:s};return i&&(n.fill=i),{type:"circle",param:n}}static ellipseItem(t,e,s,i,n){const o={cx:t,cy:e,rx:s,ry:i};return n&&(o.fill=n),{type:"ellipse",param:o}}static setStyle(t,e){t.param.style=e}}class W{static wavyItem(t,e,s,i,n){return{type:"wavy-line",param:{notex:this.prop.note.x-this.prop.noteOffsetx,notey:n,x1:t,y1:e,x2:s,y2:i}}}static yOfLine(t=0,e=1){const s=this.prop;let i=(4-t)*s.lineh/2;return e>1&&(e<=s.staffOffset.length?i+=s.staffOffset[e-1]:console.log("error staffOffset is smaller than staff")),s.note.basey&&!s.jianpu&&(i+=s.note.basey),i}}class $ extends W{static getDrawItems(t){const e=this.prop,s=[];let i=e.note.x-e.noteOffsetx;e.tabClef=!!e.curClefs&&e.curClefs[e.note.staff]===l.TAB;let n=2*e.lineh;e.tabClef&&e.note.grace?i-=.5*n:e.note.grace||e.note.cue?n*=.7:"large"===e.note.size&&(n*=1.5);let o=0;if(e.note.rest){if(e.staffOffset[e.note.staff-1]<0)return s;o=this.yOfLine(e.note.rest.line,e.note.staff);let t=o,a=i;8===e.note.type?t-=e.lineh/2:16===e.note.type||32===e.note.type?(t+=.5*e.lineh,a-=e.lineh/2):64===e.note.type?(t+=1.5*e.lineh,a-=e.lineh/2):128===e.note.type&&(t+=2.5*e.lineh,a-=e.lineh);const r=I.rest[e.note.type];s.push(B.textItem(a,t,r,n)),this.drawDots(s,i,o-e.lineh/2,e.note.rest,n),e.note.rest.pairs&&this.drawPairs(s,e.note.rest.pairs,o)}else if(e.note.elems){if(o=this.yOfLine(e.note.elems[0].line,e.note.staff),e.tabClef){const t=e.note.elems[0],o=e.note.elems[e.note.elems.length-1],a=t.pairs||o.pairs;if(a){const t=this.yOfElem(o);this.drawPairs(s,a,t)}let r=70;e.note.type>4&&(r-=5),this.drawDots(s,i-10,r,t,n)}if(e.note.guitarTech?this.drawGuitarTech(s,n):this.drawElems(s,i,n,t),this.moreLines(s),e.tabClef&&e.note.grace){const t=i-.6*e.lineh,n=i+.6*e.lineh,a=o+.7*e.lineh;s.push(B.lineItem(t,a,n,a)),s.push(B.lineItem(t,a+6,n,a+6)),s.push(B.lineItem(i,a+6,i,a+12)),s.push(B.lineItem(i,a+12,i+6,a+12))}else if(e.tabClef&&e.note.type<4){const t={y:70-o,up:!1};this.drawStem(s,t,n,o),this.drawGuitarDelayLines(s,i)}else if(e.note.stem){if(this.drawStem(s,e.note.stem,n,o),e.note.grace&&e.note.grace.slash)if(e.note.stem.up){const t=i+.4*e.lineh,n=o+e.note.stem.y+1.5*e.lineh;s.push(B.lineItem(t,n,t+1.4*e.lineh,n-1*e.lineh))}else{const t=i-.4*e.lineh,n=o+.5*e.lineh;s.push(B.lineItem(t,n,t+1.4*e.lineh,n+1*e.lineh))}e.note.beams?this.drawBeams(s,e.note.beams,o,n):!e.note.inbeam&&e.note.type>4&&this.drawTail(s,i,o,n)}}let a=i;return e.note.elems&&e.note.elems.length>1&&e.note.elems[0].x&&(a+=e.note.elems[0].x),this.getArts(s,a,o,n),s}static drawElems(t,e,s,i){const n=this.prop;if(null!=n.note.elems)for(const o of n.note.elems){const a=this.yOfElem(o);o.y=a,!n.tabClef&&o.pairs&&this.drawPairs(t,o.pairs,a);const l=o.x?e+o.x:e;if("none"!==o.head&&this.drawNoteHead(t,o,l,a,s,i),o.headtext&&this.drawHeadtext(t,o,l,a,s),n.tabClef||this.drawDots(t,e,a,o,s),o.acc){let e=l-(n.note.grace||n.note.cue?.7*n.lineh:n.lineh);o.acc.x&&(e+=o.acc.x),o.acc.acc===r.DoubleFlat||o.acc.acc===r.DoubleSharp?e-=.4*n.lineh:o.acc.acc.endsWith("Caution")&&(e-=1.3*n.lineh),t.push(B.textItem(e,a,O["ACC_"+o.acc.acc],s,o.color))}if(o.parentheses){const e=a+n.lineh/2;let i=l-n.lineh;o.acc&&(i-=n.lineh),t.push(B.textItem(i,e,"(",s,o.color)),t.push(B.textItem(l+1.3*n.lineh,e,")",s,o.color))}}}static glyphOfElem(t){let e;return t.head?(e=O["NOTE_"+t.head],e||(e=O.NOTE_4,console.log("todo to draw notehead:"+t.head))):(e=O["NOTE_"+this.prop.note.type],e||(e=this.prop.note.type<1?O.NOTE_DOUBLE_WHOLE:O.NOTE_4)),e}static drawNoteHead(t,e,s,i,n,o){const a=this.prop,r=this.glyphOfElem(e);let l;if("square_f"!==e.head&&"diamond"!==e.head&&"diamond_n"!==e.head||(n*=.6),"x"===e.head&&(a.tabClef?s-=.15*n:a.note.stem&&a.note.stem.up&&(s+=.18*n)),e.color&&(l=e.color),e.id&&a.wrongNotes&&a.wrongNotes.includes(e.id)&&(l="red"),t.push(B.textItem(s,i,r,n,l,e.id)),o){let o=this.prop.note.type<=2?l:"white",a=0==this.prop.note.type?s+.3*n:s+.15*n;t.push(B.textItem(a,i+.15*n,e.step+"",.5*n,o,e.id))}}static drawTail(t,e,s,i){var n;const o=this.prop;if(!o.note.stem)return;let a=o.note.stem.y+s,r="TAIL_"+o.note.type;o.note.stem.up?(r+="_UP",a+=1.7*i):(r+="_DOWN",a-=1.7*i);const l=O[r];l||console.log("error for tail:"+r),t.push(B.textItem(e,a,l,i,null===(n=o.note.stem)||void 0===n?void 0:n.color))}static drawHeadtext(t,e,s,i,n){const o=e.headtext;if(!o)return;const a=this.prop;let r,l,h=i+.15*n;if(r=a.note.type>=2?s+.15*n:s+.26*n,"none"===e.head)l="black",h=i+.2*n,n*=1.6,r=s-3*o.length;else if(a.note.type>=4)l="white";else if(l="black",a.note.type<=2){const e=r+.15*n,s={type:"line",param:{x1:e,y1:i,x2:e,y2:i,stroke:"white","stroke-width":.45*n,"stroke-linecap":"round"}};t.push(s)}t.push(B.textItem(r,h,o,.45*n,l))}static drawDots(t,e,s,i,n){const o=this.prop;if(o.note.dots){let a=1.4*o.lineh;1===o.note.type?a+=.5*o.lineh:o.note.type<1&&(a+=1.2*o.lineh),void 0!==i.dotx&&(a+=i.dotx);let r=i.line%2==0?s-o.lineh/2:s;i.doty&&(r+=i.doty);for(let s=0;s<o.note.dots;s++)t.push(B.textItem(e+a,r,O.ART_staccato,n,i.color)),a+=.6*o.lineh}}static getArts(t,e,s,i){const n=this.prop;if(!n.note.arts)return;i=2*n.lineh,(n.note.grace||n.note.cue)&&(i*=.7);let o=0;const r=s;for(const l of n.note.arts){const s=e+l.x;let c=r+l.y;l.up||(c-=n.lineh/3);let f=O["ART_"+l.type];if(l.type===a.fermata)l.up?f=O.ART_FERMATA_UP:(f=O.ART_FERMATA_DOWN,c+=n.lineh/3);else if(l.type===a.accent_staccato)if(l.up)f=O.ART_Accent_dot_up;else{f=O.ART_accent;const e=B.textItem(s+.25*i,c-.3*i,O.ART_staccato,i);c+=.35*i,t.push(e)}else if(l.type===a.accent_tenuto){f=O.ART_accent,l.up?c-=.2*i:c+=.2*i;const e=B.textItem(s+0*i,l.up?c+.15*i:c-.65*i,O.ART_tenuto,i);t.push(e)}else if(l.type===a.upBow)f=l.up?O.ART_BOWUP:O.ART_BOWUP_BELOW;else if(l.type===a.downBow)f=l.up?O.ART_BOWDOWN:O.ART_BOWDOWN_BELOW;else if(l.type===a.breathMark)f=O.ART_breath_mark;else if(l.type===a.detached_legato){f=O.ART_tenuto;const e=B.textItem(s+.2*i,l.up?c+.3*i:c-.3*i,O.ART_staccato,i);t.push(e)}if(f){const e=B.textItem(s,c,f,i);if((l.type===a.staccatissimo||l.type===a.spiccato||l.type===a.strongAccent||l.type===a.scoop)&&!l.up){const t=e.param;t.rotate=180,l.type===a.scoop?(t.x+=.9*n.lineh,t.y-=1.2*n.lineh):(t.x+=.5*n.lineh,t.y-=.9*n.lineh)}t.push(e)}else if(l.type===a.fingering){let e,n=l.id;if(!n&&this.prop.note.elems&&this.prop.note.elems.length>0){let t;t=o<this.prop.note.elems.length?this.prop.note.elems[this.prop.note.elems.length-o-1].id:this.prop.note.elems[0].id,n="fg_"+l.val+"_"+t,l.id=n}l.color?e=l.color:l.hide&&(e=h.uitool?"red":"rgba(0,0,0,0)");const a=B.textItem(s,c,I.num[l.val||1],.6*i,e,n);!h.uitool&&l.hide&&B.setStyle(a,"visibility: hidden;"),!0===l.alternate&&t.push(B.textItem(s-7,c+5,"-",1*i)),t.push(a),o++}else if(l.type===a.arpeggiate&&n.note.elems){const e=n.note.elems[0],s=n.note.elems[n.note.elems.length-1],o=void 0===l.line1?s.line:l.line1,a=void 0===l.line2?e.line:l.line2,r=void 0===l.staff1?s.staff||n.note.staff:l.staff1,h=void 0===l.staff2?s.staff||n.note.staff:l.staff2,c=this.yOfLine(o,r)-n.lineh,f=this.yOfLine(a,h)+n.lineh,u=0===l.x?-.8*n.lineh:l.x;if(t.push(this.wavyItem(u,0,u,f-c,c)),l.down){const e=this.prop.note.x+u;t.push(B.textItem(e,f+.5*i,O.ART_staccatissimo,1.5*i))}}else if(l.type===a.fret_string){const s=(l.line-.5)*n.lineh,o={x:e+l.x,y:s,"font-size":.8*i,"font-weight":"bold"},a={type:"text",text:l.val+"",param:o};t.push(a)}else console.log("Todo to draw note art:"+l.type);if(l.marks){const e=s+n.lineh;let i=c-2.2*n.lineh;for(const s of l.marks)s.y&&(i=r+s.y),t.push(B.textItem(e,i,O["ACC_"+s.acc],1.3*n.lineh)),i+=2.4*n.lineh}}}static moreLines(t){const e=this.prop;if(!e.note.rest&&e.note.elems){const s=e.note.elems[0],i=e.note.elems[e.note.elems.length-1];this.getMoreLines(t,s),this.getMoreLines(t,i)}}static getMoreLines(t,e){const s=this.prop;let i=0,n=0;const o=e.staff||s.note.staff;let a=5;if(s.staffLines&&s.staffLines[o]&&(a=s.staffLines[o]),e.line>a?(n=Math.floor((e.line-6)/2)+1,i=-n*s.lineh):e.line<-a&&(n=Math.floor((-e.line-6)/2)+1,i=5*+s.lineh),0!==i){const o=h.elemStaff(s.note,e);o>1&&(i+=s.staffOffset[o-1]);let a=s.note.x-s.noteOffsetx-.2*s.lineh;e.x&&(a+=e.x);let r,l=a;s.note.grace||s.note.cue?r=a+1.2*s.lineh:"arrow up"===e.head?(l=a-.7*s.lineh,r=a+1*s.lineh):"circle-x"===e.head?(l=a-.4*s.lineh,r=a+1.7*s.lineh):r=s.note.type<=1?a+2*s.lineh:a+1.7*s.lineh;for(let e=0;e<n;e++){const e=B.lineItem(l,i,r,i);t.push(e),i+=s.lineh}}}static yOfElem(t){const e=h.elemStaff(this.prop.note,t);return this.yOfLine(t.line,e)}static getStemx(t){const e=this.prop;let s=e.note.x-e.noteOffsetx+.025*t;return e.note.stem&&e.note.stem.up&&(s+=.556*t),s}static drawStem(t,e,s,i){const n=this.prop;if(!n.note.elems)return;const o=n.note.elems[0],a=n.note.elems[n.note.elems.length-1];let r=this.getStemx(s);const l=h.elemStaff(n.note,a),c=h.elemStaff(n.note,o);let f,u;if(e.up)f=this.yOfLine(o.line,c),"x"===o.head||"none"===o.head?f-=.2*s:"do"===o.head&&(f+=.2*s);else if(!n.tabClef||"x"!==a.head&&"none"!==a.head)f=this.yOfLine(a.line,l),"x"!==a.head&&"none"!==a.head||(f+=.15*s);else{if(!n.note.guitarTech&&n.note.elems.length>1)for(let s=1;s<n.note.elems.length;s++){const i=n.note.elems[s],o=n.note.elems[s-1];if(i.line>o.line+2){const s=this.yOfLine(o.line,c)-.5*n.lineh,a=this.yOfLine(i.line,c)+.5*n.lineh;t.push(B.lineItem(r,s,r,a,.1*n.lineh,e.color))}}f=this.yOfLine(o.line,c)+.8*n.lineh}if(u=void 0!==e.y?e.y*n.lineh/10+i:e.up?this.yOfLine(a.line,l)-3*n.lineh:this.yOfLine(o.line,c)+3*n.lineh,!e.up&&2===n.note.elems.length&&void 0!==a.x&&a.x>15){f+=2,r-=2;const s=r+a.x/2,i=(f+u)/2;return t.push(B.lineItem(s,i,s,u,.1*n.lineh,e.color)),t.push(B.lineItem(s,i,r+a.x+2,f,.1*n.lineh,e.color)),void t.push(B.lineItem(s,i,r,f,.1*n.lineh,e.color))}t.push(B.lineItem(r,f,r,u,.1*n.lineh,e.color));for(const h of n.note.elems)void 0!==h.x&&h.x>15&&t.push(B.lineItem(r,(f+u)/2,r+h.x,f,.1*n.lineh,e.color))}static drawGuitarTech(t,e){const s=this.prop.note.elems;if(null==s)return;const i=s[0],n=s[s.length-1],o=this.getStemx(e),a=h.elemStaff(this.prop.note,n),r=h.elemStaff(this.prop.note,i),l=this.yOfLine(n.line,a)-2,c=this.yOfLine(i.line,r)+2,f=this.prop.note.guitarTech;if("V"===f||"U"===f)t.push(B.lineItem(o,l,o,c,1));else if("A"===f||"B"===f){const e={notex:o-3,notey:18,x1:0,y1:l,x2:0,y2:c-15};t.push({type:"wavy-line",param:e})}else console.log("todo to support guitar tech",f);"V"===f||"B"===f?(t.push(B.lineItem(o-3,l+8,o,l,1)),t.push(B.lineItem(o+3,l+8,o,l,1))):(t.push(B.lineItem(o-3,c-8,o,c,1)),t.push(B.lineItem(o+3,c-8,o,c,1)))}static drawGuitarDelayLines(t,e){const s=this.prop;let i,n=2===s.note.type?1:3;s.note.dots&&(n+=1),s.nextNote&&s.nextNote.staff===s.note.staff&&s.nextNote.tick>s.note.tick?i=s.nextNote.x-s.note.x:(i=s.measWidth-s.note.x,n>3&&(i-=s.measMargin));const o=i/(n+1);let a=e;const r=2.5*s.lineh;for(let l=0;l<n;l++)a+=o,t.push(B.lineItem(a,r,a+1*s.lineh,r,.2*s.lineh))}static drawBeams(t,e,s,i){var n;const o=this.prop;if(!o.note.elems)return;let a=o.note.elems[0].staff;a||(a=o.note.staff);const r=o.note.stem&&o.note.stem.up,l=this.getStemx(i)-.5,h=null===(n=o.note.stem)||void 0===n?void 0:n.color,c=o.tabClef||o.note.grace||o.note.cue?.4*o.lineh:.5*o.lineh;for(const f of e){let e=f.y1*o.lineh/10+s;const n=void 0!==f.up2?f.up2:r;let a=(n?.6*i:.1*o.lineh)-o.noteOffsetx;if(void 0!==f.n2){f.n2>=o.notes.length&&console.log("error for beam note:"+f.n2+"/"+o.notes.length);a+=o.notes[f.n2].x}else a+=o.note.x+f.x2;let u=f.y2*o.lineh/10+s;r&&!n?(e+=.6*c,u-=1.4*c):r&&n?(e+=.5*c,u+=.5*c):(e-=.5*c,u-=.5*c),t.push(B.lineItem(l,e,a,u,c,h))}}static drawPairs(t,e,s){const i=this.prop;let n=i.note.x-i.noteOffsetx;i.tabClef&&(n-=5);for(const o of e)if("slur"===o.type||"tied"===o.type){let e=s;"slur"===o.type&&o.up&&i.note.elems&&(e=this.yOfElem(i.note.elems[i.note.elems.length-1]));const a={notex:n,notey:e,slur:o,stemup:!1,tied:!1,tieText:i.note.tieText,lineh:i.lineh,staffDistance:i.staffDistance};i.note.stem&&(a.stemup=i.note.stem.up||!1),"tied"===o.type&&(a.tied=!0),t.push({type:"slur",param:a})}else"tuplet"===o.type||"slide"===o.type||"tremolo"===o.type?t.push({type:o.type,param:Object.assign({notex:n,notey:s},o)}):"wavy-line"===o.type||"glissando"===o.type?t.push({type:"wavy-line",param:Object.assign({notex:n,notey:s},o)}):console.log("Todo to draw note pairs:"+o.type)}}class H extends W{static getDrawItems(){const t=this.prop,e=[];let s;s=void 0!==t.note.colx?t.note.colx-t.noteOffsetx:t.note.x-t.noteOffsetx;let i,n=2.5*t.lineh;if(void 0===t.note.v)i=this.yOfLine(-4,t.note.staff);else{const e=t.note.elems?t.note.elems.length:1;i=this.yOfLine(3-(7+2*e)*t.note.v,t.note.staff)}t.note.grace&&(n*=.55,i-=1.8*t.lineh,s-=.2*n);let o=i;if(t.note.rest){const a=t.measWidth,r=i;let l=t.note.rest.nums,h=a/4;if(1===t.note.type)s=t.measMargin-t.noteOffsetx,h=l?(a-s)/l:(a-s)/4;else if(2===t.note.type){l=2,0===t.note.tick&&(s=t.measMargin-t.noteOffsetx);let e=t.nextNote?t.nextNote.x-t.noteOffsetx:0;e<s&&(e=t.measWidth),h=(e-s)/2}for(let i=0;i<l;i++)if("x"===t.note.rest.head)e.push(B.textItem(s,r-.2*n,O.NOTE_x,n));else{const t=B.textItem(s+h*i,r,"0",n);t.param["font-weight"]="bold",e.push(t)}if(t.note.dots&&t.note.type>2){let i=.6*n;const o=r-.3*n;for(let a=0;a<t.note.dots;a++)e.push(B.textItem(s+i,o,O.ART_staccato,n)),i+=a*t.lineh}o-=n}else if(t.note.elems){let a=i;const r=t.note.elems.length>1?.75:1,l=n*r;for(let i=0;i<t.note.elems.length;i++){const o=t.note.elems[i],[h,c]=this.jianpuOfStep(o.step,o.octave);if(c<4){const o=4-c,r=.25*n;let h=a+.2*l;i>0?(a-=o*r,h-=o*r):t.note.grace?(h-=.2*l,a-=.2*l):t.note.type>4&&(h+=.1*l,t.note.type>8&&(h+=.1*l));const f=s+.2*n;for(let t=0;t<o;t++)e.push(B.textItem(f,h,O.ART_staccato,.9*n)),h+=r}let f;if(o.color&&(f=o.color),"x"===o.head){const t=a-.2*l;e.push(B.textItem(s,t,O.NOTE_x,n,f,o.id))}else{const t=1===h?s-1:s,i=B.textItem(t,a/r,h+"",n,f,o.id);1!==r&&(i.param.style=`transform: scale(1,${r});`),i.param["font-weight"]="bold",e.push(i),"circle"===o.enclosure&&(r<1?e.push(B.circleItem(s+7,a-.37*l,10,"rgba(0,0,0,0)")):e.push(B.circleItem(s+7,a-.35*l,12,"rgba(0,0,0,0)")))}if(t.note.dots&&t.note.type>2){let i=s+.6*n;const o=a-.3*l;for(let s=0;s<t.note.dots;s++)e.push(B.textItem(i,o,O.ART_staccato,n)),i+=t.lineh}if(c>4){const t=c-4,i=.25*n,o=s+.2*n;for(let s=0;s<t;s++){const t=a-.9*l;e.push(B.textItem(o,t,O.ART_staccato,.9*n)),a-=i}}const u=this.getAcc(t.curFifths,o,o.step);if(u){let t=s-.25*n;u.endsWith("Caution")&&(t-=.3*l);const i=a-.6*l;e.push(B.textItem(t,i,O["ACC_"+u],.6*n,f,o.id))}a-=l}o=a+.15*l;const h=t.note.elems[0];h.pairs&&(this.getPairs(e,h.pairs,i,o-3),o-=.3*l)}return this.drawBelowLines(e,s,i,n),this.getArts(e,s,i,o,n),e}static jianpuOfStep(t,e){let s=t+6;1===this.prop.jianpu&&(s+=this.jianpuSteps[this.prop.curFifths+7]);return[s%7+1,e+Math.floor(s/7)-1]}static getAcc(t,e,s){if(2===this.prop.jianpu)return 1===e.alter?r.Sharp:-1===e.alter?r.Flat:2===e.alter?r.DoubleSharp:-2===e.alter?r.DoubleFlat:null;const i=e.acc?e.acc.acc:null;if(null===i)return null;let n=i;if(0!==t&&i){const e=[4,1,5,2,6,3,7],o=Math.abs(t);for(let a=0;a<o;a++){if(t>0&&s===e[a]){"Natural"===i?n=r.Flat:"DoubleSharp"===i?n=r.Sharp:"Sharp"===i?n=null:"Flat"===i&&(n=r.DoubleFlat);break}if(t<0&&s===e[6-a]){"Natural"===i?n=r.Sharp:"DoubleFlat"===i?n=r.Flat:"Sharp"===i?n=r.DoubleSharp:"Flat"===i&&(n=null);break}}}return n}static getArts(t,e,s,i,n){const o=this.prop;if(!o.note.arts)return;let a=s-.4*n,r=s;o.note.elems?(a-=(o.note.elems.length-1)*n*1.2,r=i):r=s-2.5*o.lineh;for(const l of o.note.arts){if("tenuto"===l.type)continue;let h=l.x,c=O["ART_"+l.type];if("fermata"===l.type?(c=O.ART_FERMATA_UP,h=.35*-o.lineh):"accent_staccato"===l.type?c=O.ART_accent:"up-bow"===l.type?c=l.up?O.ART_BOWUP:O.ART_BOWUP_BELOW:"down-bow"===l.type?c=l.up?O.ART_BOWDOWN:O.ART_BOWDOWN_BELOW:"staccatissimo"===l.type?h=.17*n:"staccato"===l.type&&(c=O.ART_staccatoJianpu,h=.15*n),c)t.push(B.textItem(e+h,r,c,.65*n)),r-=o.lineh;else if("fingering"===l.type&&l.val){let s;c=this.fingers[l.val-1],o.note.elems&&1===o.note.elems.length?(s=e,a=r,r-=1.2*o.lineh):s=e+.6*n;const i=B.textItem(s,a,c,.5*n,"blue");t.push(i),a+=1.2*n}else if("arpeggiate"===l.type){const e=0===l.x?-.8*o.lineh:l.x;let n=s-i;l.staff2&&(n+=o.staffDistance+4*o.lineh),t.push(this.wavyItem(e,0,e,n,i))}else console.log("Todo to draw art:"+l.type)}}static drawBelowLines(t,e,s,i){const n=this.prop,o=s+.2*n.lineh;if(n.note.beams)for(const a of n.note.beams){const s=o+3*(a.i||0);let r=.5*i;void 0!==a.n2?r+=n.notes[a.n2].x:r+=e,t.push(B.lineItem(e,s,r,s,.1*n.lineh))}else if(!n.note.inbeam&&n.note.type>4){if(n.note.rest&&n.note.tick%n.beatTicks!=0)return;let s=1;16===n.note.type?s=2:32===n.note.type?s=3:64===n.note.type?s=4:128===n.note.type&&(s=5);const a=e;let r;r=n.nextNote&&n.nextNote.rest!==n.note.rest&&n.nextNote.tick%n.beatTicks!=0?n.nextNote.x+.5*i:a+.6*i;let l=3;const h=.1*n.lineh;if(n.note.grace){l=2,r-=.1*n.lineh;const e=a+.35*n.lineh,i=o+s*l+.2*n.lineh;t.push(B.lineItem(e,i-.4*n.lineh,e,i,h)),t.push(B.lineItem(e,i,a+.8*n.lineh,i,h))}for(let e=0;e<s;e++){const s=o+e*l;t.push(B.lineItem(a,s,r,s,h))}}else if(!n.note.rest&&n.note.type<4){let s,a=2===n.note.type?1:3;n.note.dots&&(a+=1),n.nextNote&&n.nextNote.staff===n.note.staff&&n.nextNote.tick>n.note.tick?s=n.nextNote.x-n.note.x:(s=n.measWidth-n.note.x,a>3&&(s-=n.measMargin));const r=s/(a+1);let l=e;const h=o-.7*n.lineh;for(let e=0;e<a;e++)l+=r,t.push(B.lineItem(l,h,l+.4*i,h,.1*n.lineh))}}static getPairs(t,e,s,i){const n=this.prop;for(const o of e)if("slur"===o.type||"tied"===o.type){if(!n.note.grace){const e={notex:n.note.x,notey:i,slur:o,lineh:n.lineh,jianpu:!0};t.push({type:"slur",param:e})}}else if("tuplet"===o.type||"tremolo"===o.type){const e=-n.lineh,s=Object.assign(Object.assign({notex:n.note.x,notey:i},o),{y1:e,y2:e,up:!0,jianpu:!0});t.push({type:"tuplet",param:s})}else"slide"===o.type?t.push({type:"slide",param:Object.assign(Object.assign({notex:n.note.x,notey:s},o),{jianpu:!0})}):"wavy-line"===o.type||"glissando"===o.type?t.push({type:"wavy-line",param:Object.assign(Object.assign({notex:n.note.x,notey:s},o),{jianpu:!0})}):console.log("Todo to draw jianpu pair:"+o.type)}}H.fingers=["一","二","三","四","五"],H.jianpuSteps=[0,-4,-1,-5,-2,1,-3,0,-4,-1,-5,-2,1,-3,0];class U{static getDrawItems(t,e,s){return W.prop=t,e?H.getDrawItems():$.getDrawItems(s)}static yOfLine(t,e=0,s=1){return W.prop=t,W.yOfLine(e,s)}}const J=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{class:t.noteClass},[t._l(t.items,(function(e,i){return["text"==e.type?s("text",t._b({key:i},"text",e.param,!1),[t._v(t._s(e.text))]):"line"==e.type?s("line",t._b({key:i},"line",e.param,!1)):"wavy-line"==e.type?s("NoteWaveline",t._b({key:i,attrs:{lineh:t.lineh}},"NoteWaveline",e.param,!1)):"slur"==e.type?s("NoteSlur",t._b({key:i},"NoteSlur",e.param,!1)):"tuplet"==e.type?s("NoteTuplet",t._b({key:i},"NoteTuplet",e.param,!1)):"slide"==e.type?s("NoteSlide",t._b({key:i},"NoteSlide",e.param,!1)):"tremolo"==e.type?s("NoteTremolo",t._b({key:i},"NoteTremolo",e.param,!1)):t._e()]})),t._v(" "),t.note.lyrics?[s("NoteLyrics",{attrs:{lyrics:t.note.lyrics,x:t.noteOffsetx,y:t.yOfLine(4,t.note.staff)}})]:t._e()],2)},staticRenderFns:[]},void 0,{name:"SvgNoteElem",props:{lineh:Number,noteOffsetx:{type:Number,default:0},staffDistance:Number,curFifths:Number,notes:Array,staffLines:Object,staffOffset:Array,trackIndex:Number,wrong_notes:Array,note:Object,jianpu:Number,innerJianpu:Number,nextNote:Object,measMargin:Number,measWidth:Number,beatTicks:Number},components:{NoteLyrics:z,NoteWaveline:P,NoteSlur:L,NoteTuplet:E,NoteSlide:R,NoteTremolo:D},data:function(){var t="";return void 0!==this.trackIndex&&this.note.staff&&(t="track"+(this.trackIndex+this.note.staff-1)),{noteClass:t}},computed:{items:function(){return U.getDrawItems(this._props,this.jianpu,this.innerJianpu)},style:function(){var t="";return this.jianpu||(t+="font-size: "+2*this.lineh+";"),t}},methods:{yOfLine:function(t,e){return U.yOfLine(this._props,t,e)}}},void 0,!1,void 0,!1,void 0,void 0,void 0);class q{static clefGlyphs(t){const e=[],s=t.lineh;for(const i of t.clefs){let n=t.basey+1*s;t.staffOffset&&(n+=t.staffOffset[i.staff-1]),"Treble"===i.clef||"Treble8va"===i.clef||"Treble8vb"===i.clef?n+=2*s:"Percussion"===i.clef?n+=1*s:"TAB"===i.clef&&(n+=2*s);let o=2*s;i.scale?o*=i.scale:t.scale&&(o*=t.scale);let a=O["Clef_"+i.clef];a||(a=i.clef.startsWith("Bass")?O.Clef_Bass:O.Clef_Middle,n-=(this.lineOfClef[i.clef]-4)*s);const r="track"+(t.trackIndex+i.staff-1),l={x:i.x,y:n,"font-size":o,class:r};e.push({param:l,text:a})}return e}}q.lineOfClef={Alto:3,UpAlto:4,DownDownAlto:1,DownAlto:2,UpUpAlto:5,Percussion:1,Bass3:3,Bass2:2,Bass1:1};const G=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",t._l(t.clefGlyphs,(function(e,i){return s("text",t._b({key:"c"+i},"text",e.param,!1),[t._v(t._s(e.text))])})),0)},staticRenderFns:[]},void 0,{name:"SvgClef",props:{basey:{type:Number,default:0},clefs:Array,lineh:Number,staffOffset:Array,scale:Number,trackIndex:Number},computed:{clefGlyphs:function(){return q.clefGlyphs(this._props)}}},void 0,!1,void 0,!1,void 0,void 0,void 0),V=new Set(["augmented","diminished","diminished-seventh","diminished-11th","major-sixth","dominant","dominant-ninth","dominant-11th","dominant-13th","major-seventh","major-ninth","major-11th","major-13th","major-add9","major_add11","major_sixth_add9","suspended-second","suspended-fourth","half-diminished"]),Y={major:"",minor:"m",augmented:"+",diminished:"o",dominant:"7","major-seventh":"maj7","minor-seventh":"m7","diminished-seventh":"o7","augmented-seventh":"+7","half-diminished":"ø7","major-minor":"m(maj7)","major-sixth":"6","minor-sixth":"m6","major-add9":"add9",major_add11:"add11",major_sixth_add9:"6add9","dominant-ninth":"9","major-ninth":"maj9","minor-ninth":"m9","diminished-11th":"o11","dominant-11th":"11","major-11th":"maj11","minor-major-11th":"-maj11","minor-11th":"m11","dominant-13th":"13","major-13th":"maj13","minor-major-13th":"-maj13","minor-13th":"m13","suspended-second":"(sus2)","suspended-fourth":"(sus4)"},X={0:0,7:0,"-7":0,2:1,"-5":1,4:2,"-3":2,6:3,"-1":3,1:4,"-6":4,3:5,"-4":5,5:6,"-2":6},K=["①","②","③","④","⑤","⑥","⑦"],Q=["C","D","E","F","G","A","B"];class Z{static getItems(t){const e=[],s=this.getFrameItems(t,e),i=this.getSpanItems(t);let n=0,o=0;s>0&&(n+=.6*s-.2*s*i.length,o-=s);const a={type:"span",param:{x:n,y:o,items:i}};return e.push(a),e}static getFrameItems(t,e){const s=t.harmony.frame;if(s){const i=.7*t.lineh,n=(s.strings-1)*i,o=(s.frets-1)*i,a=-o;s.baseFret&&e.push(B.textItem(-1.3*i,a+i,""+(s.baseFret+1),1.6*i));for(let t=0;t<s.frets;t++){const o=0===t&&void 0===s.baseFret?3:1;e.push(B.lineItem(-.5,a+t*i,n+.5,a+t*i,o))}for(let t=0;t<s.strings;t++)e.push(B.lineItem(t*i,0,t*i,-o));const r=[1,1,1,1,1,1],l=.3*i;for(const t of s.notes){const s=i*(6-t.str);let n=a+i*t.fret-i/2;0===t.fret?(n-=1,e.push(B.circleItem(s,n,l,"white"))):e.push(B.circleItem(s,n,l)),r[t.str-1]=0}for(let t=0;t<r.length;t++){if(r[t]){const s=i*(5-t),n=a-i/2-1;e.push(B.lineItem(s-l,n-l,s+l,n+l)),e.push(B.lineItem(s-l,n+l,s+l,n-l))}}return 6*i}return 0}static getSpanItems(t){this.dy=0,this.lineh=t.lineh;const e=[];if(t.jianpu){const s=K[this.jianpuStep(t.harmony.root.step,t.fifths)];e.push({text:s})}else e.push({text:t.harmony.root.step});if(0===t.harmony.root.alter||t.jianpu||(-1===t.harmony.root.alter?e.push(this.dxyItem("♭",-9,-2,1.6*t.lineh)):1===t.harmony.root.alter&&e.push(this.dxyItem("#",-5,-1,1.9*t.lineh))),V.has(t.harmony.kind.type)){const s=t.harmony.kind.text||Y[t.harmony.kind.type];""!==s&&e.push(this.upItem(s))}else switch(t.harmony.kind.type){case"minor-sixth":e.push(this.minorItem()),e.push(this.upItem("6"));break;case"minor-seventh":e.push(this.minorItem()),e.push(this.upItem("7"));break;case"minor-ninth":e.push(this.minorItem()),e.push(this.upItem("9"));break;case"minor-11th":e.push(this.minorItem()),e.push(this.upItem("11"));break;case"minor-13th":e.push(this.minorItem()),e.push(this.upItem("13"));break;case"major-minor":e.push(this.minorItem()),e.push(this.upItem("(maj7)"));break;case"minor":e.push(this.minorItem());break;case"major":break;default:{const s=t.harmony.kind.text||Y[t.harmony.kind.type];""!==s&&e.push({text:s})}}if(t.harmony.degree){const s=t.harmony.degree;1===s.alter&&"add"===s.type&&7===s.value?e.push(this.upItem(`(maj${s.value})`)):0!==s.alter||"add"!==s.type||11!==s.value&&13!==s.value?0===s.alter?"add"===s.type?e.push(this.upItem(`(add${s.value})`)):e.push(this.upItem(`(${s.type}${s.value})`)):1===s.alter?e.push(this.upItem(`(#${s.value})`)):-1===s.alter?e.push(this.upItem(`(b${s.value})`)):(e.push(this.upItem("(")),e.push(this.upItem(s.value+")"))):e.push(this.upItem(`(maj${s.value})`))}if(t.harmony.bass&&""!==t.harmony.bass.step){const s=t.harmony.bass;let i=s.alter;if(t.jianpu){const n=this.jianpuStep(s.step,t.fifths)+1;if(i=this.jianpuAlter(s.step,s.alter,t.fifths),e.push(this.dxyItem("/"+n,-5)),s.oct<4&&s.oct>0){const i=4-s.oct,n=2.1*t.lineh;let o=.65*-n;for(let t=0;t<i;t++)e.push(this.dxyItem(".",o,4,n)),o+=.1*n}1===i?e.push(this.dxyItem("#",-4)):-1===i&&e.push(this.dxyItem("♭",-7))}else{const t=s.step;1===i?e.push(this.dxyItem(`/${t}#`,-5)):-1===i?e.push(this.dxyItem(`/${t}♭`,-5)):e.push(this.dxyItem("/"+t,-5))}}return e}static upItem(t){return this.dxyItem(t,-4,-5,1.1*this.lineh)}static minorItem(){return this.dxyItem("m",-4,0,1.6*this.lineh)}static dxyItem(t,e,s,i){const n={};return e&&(n.dx=e),s?(n.dy=s,this.dy+=s):this.dy&&(n.dy=-this.dy,this.dy=0),i&&(n["font-size"]=i),{text:t,param:n}}static jianpuStep(t,e){const s=X[e];return(7+Q.indexOf(t)-s)%7}static jianpuAlter(t,e,s){const i=["F","C","G","D","A","E","B"];if(e>0&&s>0){for(let n=0;n<s;n++)if(t===i[n]){e-=1;break}}else if(e<0&&s<0){const n=-s;for(let s=0;s<n;s++)if(t===i[6-s]){e+=1;break}}return e}}Z.dy=0,Z.lineh=0;const tt=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.harmony.x+","+t.y+")"}},[t._l(t.items,(function(e,i){return["text"==e.type?s("text",t._b({key:"i"+i},"text",e.param,!1),[t._v(t._s(e.text))]):t._e(),t._v(" "),"line"==e.type?s("line",t._b({key:"l"+i},"line",e.param,!1)):t._e(),t._v(" "),"circle"==e.type?s("circle",t._b({key:"c"+i,attrs:{stroke:"black","stroke-width":"1"}},"circle",e.param,!1)):t._e(),t._v(" "),"span"==e.type?s("text",{key:"s"+i,attrs:{x:e.param.x,y:e.param.y,"font-size":2*t.lineh}},t._l(e.param.items,(function(e,i){return s("tspan",t._b({key:i},"tspan",e.param,!1),[t._v(t._s(e.text)+" ")])})),0):t._e()]}))],2)},staticRenderFns:[]},void 0,{name:"MeasHarmony",props:{harmony:Object,lineh:Number,fifths:Number,jianpu:Boolean,staffOffset:Array},data:function(){var t=this.harmony.y;return this.harmony.staff>1&&(t+=this.staffOffset[this.harmony.staff-1]),{y:t}},computed:{items:function(){return Z.getItems(this._props)},svgItems:function(){return Z.getFrameItems(this._props)}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const et=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",[s("text",{attrs:{x:t.x1-t.lineh,y:t.y+.8*t.lineh,"font-size":2*t.lineh}},[t._v(t._s(t.text))]),t._v(" "),s("line",{attrs:{x1:t.x1+1.5*t.lineh,x2:t.x2,y1:t.y,y2:t.y,"stroke-dasharray":"5.5",stroke:"black"}}),t._v(" "),s("line",{attrs:{x1:t.x2,x2:t.x2,y1:t.y,y2:t.up?t.y-5:t.y+5,stroke:"black"}})])},staticRenderFns:[]},void 0,{name:"MeasPdirOctave",props:{x1:Number,y1:Number,x2:Number,y2:Number,line:String,staff:Number,lineh:Number,staffOffset:Array,size:Number,up:Boolean,stopx:Number,type:String,continueOffset:Number},data:function(){var t=this.y1;return this.staff>1&&this.staffOffset&&(t+=this.staffOffset[this.staff-1]),{y:t,text:8===this.size?this.up?O.OCTAVE_8vb:O.OCTAVE_8va:O.OCTAVE_15ma}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const st=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{stroke:"black"}},[s("line",{attrs:{x1:t.x1,x2:t.x2,y1:t.lefty1,y2:t.righty1}}),t._v(" "),s("line",{attrs:{x1:t.x1,x2:t.x2,y1:t.lefty2,y2:t.righty2}})])},staticRenderFns:[]},void 0,{name:"MeasPdirWedge",props:{x1:Number,y1:Number,x2:Number,y2:Number,line:String,staff:Number,lineh:Number,staffOffset:Array,continueOffset:Number,crescendo:Boolean,type:String,stopx:Number},data:function(){var t=this.y1,e=this.y2;return this.staff>1&&(t+=this.staffOffset[this.staff-1],e+=this.staffOffset[this.staff-1]),{lefty:t,righty:e}},computed:{lefty1:function(){var t=this.lefty;return this.crescendo?this.continueOffset&&(t-=.2*this.lineh):t-=.6*this.lineh,t},lefty2:function(){var t=this.lefty;return this.crescendo?this.continueOffset&&(t+=.2*this.lineh):t+=.6*this.lineh,t},righty1:function(){var t=this.righty;return this.crescendo?t-=.6*this.lineh:0===this.continueOffset&&(t-=.2*this.lineh),t},righty2:function(){var t=this.righty;return this.crescendo?t+=.6*this.lineh:0===this.continueOffset&&(t+=.2*this.lineh),t}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const it=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{stroke:"black"}},["down"==t.end1?s("line",{attrs:{x1:t.x1,x2:t.x1,y1:t.lefty,y2:t.lefty+5}}):"up"==t.end1?s("line",{attrs:{x1:t.x1,x2:t.x1,y1:t.lefty,y2:t.lefty-5}}):t._e(),t._v(" "),s("line",t._b({attrs:{x1:t.x1,x2:t.x2,y1:t.lefty,y2:t.righty}},"line",t.lineParam,!1)),t._v(" "),"down"==t.end2?s("line",{attrs:{x1:t.x2,x2:t.x2,y1:t.righty,y2:t.righty+5}}):"up"==t.end2?s("line",{attrs:{x1:t.x2,x2:t.x2,y1:t.righty,y2:t.righty-5}}):t._e()])},staticRenderFns:[]},void 0,{name:"MeasPdirBracket",props:{x1:Number,y1:Number,x2:Number,y2:Number,line:String,staff:Number,lineh:Number,staffOffset:Array,end1:String,end2:String},data:function(){var t=this.y1,e=this.y2;return this.staff>1&&(t+=this.staffOffset[this.staff-1],e+=this.staffOffset[this.staff-1]),{lefty:t,righty:e}},computed:{lineParam:function(){var t={};return"dashed"===this.line&&(t["stroke-dasharray"]="7,7"),t}}},void 0,!1,void 0,!1,void 0,void 0,void 0);const nt=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",[s("line",{attrs:{x1:t.x1,y1:t.y,x2:t.x1,y2:t.y+15,stroke:"black"}}),t._v(" "),s("line",{attrs:{x1:t.x1,y1:t.y,x2:t.x2,y2:t.y,stroke:"black"}}),t._v(" "),t.stop?s("line",{attrs:{x1:t.x2,y1:t.y,x2:t.x2,y2:t.y+15,stroke:"black"}}):t._e(),t._v(" "),t.num?s("text",{attrs:{x:t.x1+5,y:t.y+15}},[t._v(t._s(t.num+"."))]):t._e()])},staticRenderFns:[]},void 0,{name:"MeasEnding",props:{num:String,x1:Number,x2:Number,y:Number,stop:Boolean}},void 0,!1,void 0,!1,void 0,void 0,void 0);class ot{constructor(t){var e;if(this.items=[],this.shapes=[],this.measure=t.measure,this.curFifths=t.curFifths,this.lineh=t.lineh,this.staffOffset=t.staffOffset,this.wrongEvents=t.wrong_events,this.jianpu=t.jianpu,this.isFirstMeasure=t.isFirstMeasure,this.measureIndex=t.measureIndex,this.measures=t.measures,this.staffDistance=t.staffDistance,this.keyw=t.keyw,this.trackIndex=t.trackIndex,this.measure.dirs)for(const s of this.measure.dirs){if("metronome"===s.type){this.getMetronomeItems(s);continue}if("graphics"===s.type){this.drawGraphics(s);continue}if("sym"===s.type&&s.text.startsWith("Accord_")){this.drawSym(s);continue}const t=s.param?Object.assign({},s.param):{};t["font-size"]||(t["font-size"]=1.8*this.lineh),s.staff>1&&this.staffOffset&&(t.y+=this.staffOffset[s.staff-1]);let e=s.text;if("Swing!  iq=qK  e"!==e){if("f-p"===e){t["font-style"]&&(t["font-style"]=void 0);const s=.7*t["font-size"];let i=t.x-s;const n=Object.assign(Object.assign({},t),{x:i});this.items.push({type:"text",text:O.f,param:n}),i+=s,this.items.push(B.lineItem(i,t.y,i+.8*s,t.y)),i+=.8*s,t.x=i,e=O.p}else if(s.type){if("pedal"===s.type){if(s.line){this.pedalLines(s);continue}0===t.y&&(t.y=8*this.lineh),"start"===s.text?e=O.ART_PEDAL_DOWN:(e=O.ART_PEDAL_UP,t.x-=1.5*this.lineh)}else{if("sfp"===e||"sff"===e){const s=Object.assign({},t);this.items.push({type:"text",text:O.sf,param:s}),t.x+=.65*t["font-size"],e="sfp"===e?O.p:O.f}else e=O[e];e||console.log("Todo to draw dirs: "+s.type+" text:"+s.text)}this.keyw&&(t.x-=this.keyw)}else"("===e?t.x-=.8*this.lineh:")"===e&&(t.x+=1.5*this.lineh);this.items.push({type:"text",text:e,param:t}),s.enclosure&&this.drawEnclosure(s.enclosure,t.x,t.y)}else this.getSwingItems(s.param)}if(null!=this.measure.mrest){let t=.1*this.measure.w+(this.measure.keyw?this.measure.keyw:0);if(0===this.measureIndex){t+=5*this.lineh;const s=(null===(e=this.measure.fifths)||void 0===e?void 0:e.fifths)||0;s&&(t+=Math.abs(s)*this.lineh)}const s=.9*this.measure.w;for(let e=0;e<this.measure.staves;e++){const i=2*this.lineh+this.staffOffset[e],n=B.lineItem(t,i,s,i,6);this.items.push(n);const o=this.lineh,a=B.lineItem(t,i-o,t,i+o);this.items.push(a);const r=B.lineItem(s,i-o,s,i+o);this.items.push(r);const l=B.textItem((t+s)/2,i-22,""+this.measure.mrest,25);this.items.push(l)}}}get rects(){const t=[];if(this.wrongEvents&&this.measure.notes&&this.measure.notes.length>0){const e=-100,s=this.measure.notes[0].x,i=this.measure.w-s;for(const n of this.wrongEvents){if(n.track<this.trackIndex||n.track>=this.trackIndex+this.measure.staves)continue;const o=s+n.x*i/100,a=e+3*(120-n.val);let r,l=n.w*i/100;if(l<3&&(l=3),r=1===n.staff?n.wrong?"#fe0":"#2b2":n.wrong?"#f20":"#0a0",t.push(B.rectItem(o,a,l,5,r)),void 0!==n.note_x){let e=(4-n.line)*this.lineh/2;n.staff>1&&this.staffOffset&&(e+=this.staffOffset[n.staff-1]);const s=n.note_x+this.lineh/2,i=B.lineItem(s,e,o+l/2,a+3,void 0,"#0af");t.push(i)}if(n.msg){const e={x:o,y:a,"font-size":8};t.push({type:"text",text:n.msg,param:e})}}}return t}get timex(){let t=this.lineh;return this.jianpu&&this.isFirstMeasure?t+=(4+Math.abs(this.curFifths))*this.lineh:this.measure.fifths&&(this.measure.fifths.fifths||this.measure.fifths.cancel)&&(t+=(.5+Math.abs(this.measure.fifths.fifths)+Math.abs(this.measure.fifths.cancel||0))*this.lineh),t}get beatTicks(){const t=this.prevTime();if(t){const e=t.beatu||4;if(8===e)return 720;if(2===e)return 960}return 480}flagItems(t){const e=[],s=t.beats;if(s&&t.style){let i=this.measure.keyw||this.lineh,n=this.measure.notes[0];for(const t of this.measure.notes)t.x<n.x&&(n=t);(!n.rest||n.rest&&n.type>1)&&(i=n.x);const o=5*this.lineh+this.staffDistance/2,a=t.style.color?t.style.color:"red",r=t.style.fontSize?t.style.fontSize:30,l=(this.measure.w-i)/s;for(let t=1;t<=s;t++){const s=B.textItem(i,o,""+t,r,a);e.push(s),i+=l}}return e}getFifthsParam(){let t=this.lineh,e=0;return this.jianpu&&this.measure.fifths&&(t+=(2+Math.abs(this.measure.fifths.fifths))*this.lineh,e-=2*this.lineh),{x:t,y:e}}getBarlinex(){let t=0;return this.isFirstMeasure&&(t=this.lineh*(Math.abs(this.curFifths)+6.5),this.measure.time&&(t+=2*this.lineh)),t}getMeasMargin(t){let e=0;return this.jianpu=t,0===this.measureIndex&&this.jianpu?(e=this.lineh*(Math.abs(this.curFifths)+9),this.measure.lbar&&(e+=2*this.lineh)):e=this.jianpu&&this.isFirstMeasure?this.lineh*(Math.abs(this.curFifths)+6):this.measure.keyw?this.measure.keyw:15,e}getClefs(){if(!this.measure.clefs)return;const t=[];for(const e of this.measure.clefs){let s=e.x;if(0===s){if(this.isFirstMeasure)continue;if(s=-2.2*this.lineh,this.measureIndex>0){const t=this.measures[this.measureIndex-1];t.rbar&&"backward"===t.rbar.repeat&&(s-=1.2*this.lineh)}}else s-=2.5*this.lineh,this.keyw&&(s-=this.keyw),s>this.measure.w-2.5*this.lineh&&(s=this.measure.w-2.5*this.lineh);t.push(Object.assign(Object.assign({},e),{x:s,scale:.75}))}return t}nextNote(t){if(this.measure.notes&&t<this.measure.notes.length-1){const e=this.measure.notes[t],s=this.measure.notes[t+1];if(s.tick>e.tick&&s.staff===e.staff&&s.v===e.v)return s}}drawEnclosure(t,e,s){"rectangle"===t||"square"===t?this.shapes.push({component:"rect",param:{x:e-.8*this.lineh,y:s-1.8*this.lineh,width:2.8*this.lineh,height:2.8*this.lineh,style:"fill:none;stroke-width:1; stroke:rgb(0,0,0)"}}):"circle"===t?this.shapes.push({component:"circle",param:{cx:e+.3*this.lineh,cy:s-.5*this.lineh,r:.7*this.lineh,style:"fill:none;stroke-width:1; stroke:rgb(0,0,0)"}}):console.log("Todo to draw dir enclosure:"+t)}drawGraphics(t){const e=t.param.x,s=t.param.x1;let i=t.param.y,n=t.param.y1;if(t.staff>1&&this.staffOffset&&(i+=this.staffOffset[t.staff-1],n+=this.staffOffset[t.staff-1]),"line"===t.param.graph)this.items.push(B.lineItem(e,i,s,n));else if("rect"===t.param.graph)this.items.push(B.rectItem(e,i,s-e,n-i,void 0,t.param.rx));else if("ellipse"===t.param.graph){const t=(e+s)/2,o=(i+n)/2,a=(s-e)/2,r=Math.abs(n-i)/2;this.items.push(B.ellipseItem(t,o,a,r,"white"))}}drawSym(t){if(10===t.text.length&&t.text.startsWith("Accord_")){const e=t.param.x,s=t.param.y,i=1.2*this.lineh;this.items.push(B.circleItem(e,s,i,"rgba(0,0,0,0)")),this.items.push(B.lineItem(e-i,s-4,e+i,s-4)),this.items.push(B.lineItem(e-i,s+4,e+i,s+4));const n=[t.text[7],t.text[8],t.text[9]];let o=s-.65*i;for(const t of n)"1"===t?this.drawDot(e-2,o):"2"===t&&(this.drawDot(e-6,o),this.drawDot(e+2,o)),o+=.65*i}}drawDot(t,e){const s={x:t,y:e,"font-size":1.7*this.lineh};this.items.push({type:"text",text:O.ART_staccato,param:s})}prevTime(){for(let t=this.measureIndex;t>=0;t--){const e=this.measures[t];if(e.time)return e.time}}getSwingItems(t){let e=t.x;const s=t.y;this.items.push({type:"text",text:"Swing!",param:{x:e,y:s,"font-weight":"bold"}}),e+=60,this.swingItems(e,s)}swingItems(t,e){const s=this.swingNote(t,e,8);s.beams=[{y1:-2*this.lineh,y2:-2*this.lineh,x2:15}],this.items.push({type:"note",param:s}),t+=15;const i=this.swingNote(t,e,8);i.inbeam=!0,this.items.push({type:"note",param:i}),t+=15,this.items.push({type:"text",text:"=",param:{x:t,y:e}}),t+=15;const n=this.swingNote(t,e,4);if(n.elems){const t={type:o.tuplet,bracket:!0,up:!0,value:3,x1:5,x2:20,y1:-2*this.lineh,y2:-2*this.lineh};n.elems[0].pairs=[t]}this.items.push({type:"note",param:n}),t+=15;const a=this.swingNote(t,e,8);this.items.push({type:"note",param:a})}swingNote(t,e,s,i=0){const n=new h;n.grace={slash:!1},n.x=t,n.type=s,n.dots=i,n.stem={type:"up",up:!0,y:-2*this.lineh},n.basey=e;const o=h.newElem();return o.line=3,n.elems=[o],n}metronomeNote(t,e,s,i=0){const n=O[1===s?"NOTE_"+s:"NOTE_"+s+"_UP"];let o=t;this.items.push({type:"text",text:n,param:{x:o,y:e,"font-size":1.7*this.lineh}}),o+=1.5*this.lineh;const a=i||0;for(let r=0;r<a;r++){const t={x:o,y:e,"font-size":1.7*this.lineh};this.items.push({type:"text",text:O.ART_staccato,param:t}),o+=.5*this.lineh}return o}getTextWidth(t,e,s){let i=5;for(const n of t)i+="l"===n||"i"===n||"j"===n||"I"===n?.25*e:"f"===n||"r"===n||"t"===n?.35*e:"m"===n||"w"===n?.7*e:.55*e;return i}getTextWidthEx(t,e,s){const i=document.createElement("span");let n=i.offsetWidth;return i.style.fontSize=e+"px",void 0!==s&&(i.style.fontWeight=s),i.style.visibility="hidden",i.style.display="inline-block",document.body.appendChild(i),void 0!==i.textContent?i.textContent=t:i.innerText=t,n=parseFloat(window.getComputedStyle(i).width)-n,document.body.removeChild(i),n}getMetronomeItems(t){let e=t.param.x;const s=t.param.y,i=1.5*(t.param["font-size"]||1.4*this.lineh);if(t.textl){this.items.push({type:"text",text:t.textl,param:{x:e,y:s,id:"metronome","font-weight":"bold","font-size":i}});let n=this.getTextWidthEx(t.textl,i,"bold");0===n&&(n=this.getTextWidth(t.textl,i,"bold")),e+=n+this.lineh}if(t.parentheses&&(this.items.push({type:"text",text:"(",param:{x:e,y:s}}),e+=.8*this.lineh),t.notel&&(e=this.metronomeNote(e,s,t.notel,t.notel_dot)),t.value){const i="= "+t.value;this.items.push({type:"text",text:i,param:{x:e,y:s,"font-size":1.8*this.lineh}});e+=this.getTextWidthEx(i,1.8*this.lineh)}else t.noter&&(this.items.push({type:"text",text:"=",param:{x:e,y:s}}),e=this.metronomeNote(e,s,t.noter,t.noter_dot),e+=.5*this.lineh);t.parentheses&&(this.items.push({type:"text",text:")",param:{x:e,y:s}}),e+=this.lineh),(t.swing||t.textl&&t.textl.indexOf("swing")>=0)&&(e+=this.lineh,this.items.push({type:"text",text:"(",param:{x:e,y:s}}),e+=this.lineh,this.swingItems(e,s),e+=8*this.lineh,this.items.push({type:"text",text:")",param:{x:e,y:s}}),e+=this.lineh),t.textr&&(e+=this.lineh,this.items.push({type:"text",text:t.textr,param:{x:e,y:s,"font-size":i}}))}pedalLines(t){let e=t.param.y||0;t.staff>1&&this.staffOffset&&(e+=this.staffOffset[t.staff-1]);let s,i=t.x1||t.param.x||0;if("change"===t.text?(s=B.lineItem(i,e,i+3,e-8),this.items.push(s),s=B.lineItem(i+3,e-8,i+6,e),this.items.push(s),i+=6):t.str?(this.items.push({type:"text",text:t.str,param:{x:i,y:e+3}}),i+=30):(s=B.lineItem(i,e-8,i,e),this.items.push(s)),void 0!==t.stopx){const n=t.x2||t.stopx||0;s=B.lineItem(i,e,n,e),this.items.push(s)}}}const at=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.w>0?s("g",{attrs:{transform:"translate("+t.x+",0)",fill:t.measureInfo.flags&&t.measureInfo.flags.foreground?t.measureInfo.flags.foreground:void 0}},[t.oneline&&t.isTopMeasure&&t.measureIndex%10==9?[s("rect",{staticStyle:{fill:"rgba(0,0,0,0)","stroke-width":"1",stroke:"black"},attrs:{x:-5,y:2.4*-t.lineh,width:1.6*t.lineh,height:1.5*t.lineh}}),t._v(" "),s("text",{attrs:{x:-3,y:1.2*-t.lineh,"font-size":1.1*t.lineh}},[t._v(t._s(t.measure.num))])]:t._e(),t._v(" "),!t.isFirstMeasure&&!t.jianpu||t.measureIndex>0&&t.isTopMeasure&&t.jianpu?[t.measure.fifths?[s("SvgFifths",t._b({attrs:{fifths:t.measure.fifths.fifths,cancel:t.measure.fifths.cancel,clef:t.curClefs,staffOffset:t.staffOffset,staves:t.measure.staves,lineh:t.lineh,jianpu:0!=t.jianpu,trackIndex:t.trackIndex}},"SvgFifths",t.getFifthsParam(),!1))]:t._e(),t._v(" "),t.measure.time?[s("SvgTime",{attrs:{time:t.measure.time,x:t.timex,lineh:t.lineh,staffOffset:t.staffOffset,staves:t.measure.staves,jianpu:0!=t.jianpu,trackIndex:t.trackIndex}})]:t._e()]:t._e(),t._v(" "),!t.jianpu&&t.measure.clefs?[s("SvgClef",{attrs:{clefs:t.obj.getClefs(),lineh:t.lineh,staffOffset:t.staffOffset,scale:.75,trackIndex:t.trackIndex}})]:t._e(),t._v(" "),t._l(t.measure.harmonys,(function(e,i){return[s("MeasHarmony",{key:"h"+i,attrs:{harmony:e,lineh:t.lineh,jianpu:0!=t.jianpu,fifths:t.curFifths,staffOffset:t.staffOffset}})]})),t._v(" "),t._l(t.measure.pdirs,(function(e,i){return[t.jianpu||"shift"!=e.type?"wedge"==e.type?s("MeasPdirWedge",t._b({key:"p"+i,attrs:{lineh:t.lineh,staffOffset:t.staffOffset}},"MeasPdirWedge",e,!1)):"bracket"==e.type?s("MeasPdirBracket",t._b({key:"p"+i,attrs:{lineh:t.lineh,staffOffset:t.staffOffset}},"MeasPdirBracket",e,!1)):t._e():s("MeasPdirOctave",t._b({key:"p"+i,attrs:{lineh:t.lineh,staffOffset:t.staffOffset}},"MeasPdirOctave",e,!1))]})),t._v(" "),t.measure.ends?[s("MeasEnding",t._b({attrs:{stop:t.measure.ends.stop||0==t.measure.ends.discontinue}},"MeasEnding",t.measure.ends,!1))]:t._e(),t._v(" "),t.continues?[t._l(t.continues,(function(e,i){return[t.jianpu||"shift"!=e.type?"slur"==e.type&&(!e.jianpu&&!t.jianpu||e.jianpu&&t.jianpu)?s("NoteSlur",t._b({key:"pc"+i,attrs:{lineh:t.lineh,jianpu:0!=t.jianpu}},"NoteSlur",e,!1)):"wedge"==e.type?s("MeasPdirWedge",t._b({key:"pc"+i,attrs:{lineh:t.lineh,staffOffset:t.staffOffset}},"MeasPdirWedge",e,!1)):"wavy-line"==e.type?s("NoteWaveline",t._b({key:"wl"+i,attrs:{lineh:t.lineh}},"NoteWaveline",e,!1)):t._e():s("MeasPdirOctave",t._b({key:"pc"+i,attrs:{lineh:t.lineh,staffOffset:t.staffOffset}},"MeasPdirOctave",e,!1))]}))]:t._e(),t._v(" "),t.groupInfo?[t.measure.lbar?t._l(t.getBarlines(!0),(function(e,i){return s("line",t._b({key:"bl"+i,attrs:{stroke:"black"}},"line",e,!1))})):t._e(),t._v(" "),t._l(t.getBarlines(!1),(function(e,i){return s("line",t._b({key:"br"+i,attrs:{stroke:"black"}},"line",e,!1))}))]:t._e(),t._v(" "),t._l(t.items,(function(e,i){return["text"==e.type?s("text",t._b({key:"t"+i},"text",e.param,!1),[t._v(t._s(e.text))]):t._e(),t._v(" "),"line"==e.type?s("line",t._b({key:"l"+i},"line",e.param,!1)):t._e(),t._v(" "),"rect"==e.type?s("rect",t._b({key:"r"+i,staticStyle:{fill:"rgba(0,0,0,0)","stroke-width":"1",stroke:"black"}},"rect",e.param,!1)):t._e(),t._v(" "),"ellipse"==e.type?s("ellipse",t._b({key:"e"+i,attrs:{stroke:"black","stroke-width":"1"}},"ellipse",e.param,!1)):t._e(),t._v(" "),"circle"==e.type?s("circle",t._b({key:"c"+i,attrs:{stroke:"black","stroke-width":"1"}},"circle",e.param,!1)):t._e(),t._v(" "),"note"==e.type?s("SvgNoteElem",{key:"i"+i,attrs:{note:e.param,lineh:t.lineh}}):t._e()]})),t._v(" "),t._l(t.shapes,(function(e,i){return[s(e.component,t._b({key:"s"+i,tag:"component",attrs:{lineh:t.lineh}},"component",e.param,!1))]})),t._v(" "),t._l(t.allNotes,(function(e,i){return[e.hide?t._e():s("g",{key:i,class:e.class},[t._l(e.items,(function(i,n){return["text"==i.type?s("text",t._b({key:n},"text",i.param,!1),[t._v(t._s(i.text))]):t._e(),t._v(" "),"line"==i.type?s("line",t._b({key:n,class:e.class},"line",i.param,!1)):t._e(),t._v(" "),"rect"==i.type?s("rect",t._b({key:"r"+n,staticStyle:{fill:"rgba(0,0,0,0)","stroke-width":"1",stroke:"black"}},"rect",i.param,!1)):t._e(),t._v(" "),"circle"==i.type?s("circle",t._b({key:"c"+n,attrs:{stroke:"black","stroke-width":"1"}},"circle",i.param,!1)):"wavy-line"==i.type?s("NoteWaveline",t._b({key:n,attrs:{lineh:t.lineh}},"NoteWaveline",i.param,!1)):"slur"==i.type?s("NoteSlur",t._b({key:n},"NoteSlur",i.param,!1)):"tuplet"==i.type?s("NoteTuplet",t._b({key:n},"NoteTuplet",i.param,!1)):"slide"==i.type?s("NoteSlide",t._b({key:n},"NoteSlide",i.param,!1)):"tremolo"==i.type?s("NoteTremolo",t._b({key:n},"NoteTremolo",i.param,!1)):t._e()]})),t._v(" "),e.lyrics?[s("NoteLyrics",{attrs:{lyrics:e.lyrics,x:t.noteOffsetx,y:t.yOfLine(4,e,i)}})]:t._e()],2)]})),t._v(" "),t.wrong_events?[s("rect",{attrs:{x:0,y:-2*t.lineh,width:t.w,height:t.staffDistance+12*t.lineh,fill:"rgba(200,200,250,0.6)"}}),t._v(" "),t._l(t.rects,(function(e,i){return["rect"==e.type?s("rect",t._b({key:"b"+i},"rect",e.param,!1)):t._e(),t._v(" "),"line"==e.type?s("line",t._b({key:"b"+i},"line",e.param,!1)):t._e(),t._v(" "),"text"==e.type?s("text",t._b({key:"b"+i},"text",e.param,!1),[t._v(" "+t._s(e.text)+" ")]):t._e()]}))]:t._e(),t._v(" "),t.measureInfo.flags?t._l(t.flags,(function(e,i){return s("text",t._b({key:"f"+i},"text",e.param,!1),[t._v(t._s(e.text))])})):t._e()],2):t._e()},staticRenderFns:[]},void 0,{name:"SvgMeasure",props:{measure:Object,measureIndex:Number,x:Number,w:Number,keyw:Number,lineh:Number,curClefs:Object,curFifths:Number,groupInfo:Object,staffDistance:Number,jianpu:Number,innerJianpu:Number,continues:Array,isFirstMeasure:Boolean,isTopMeasure:Boolean,staffLines:Object,measures:Array,addedNotes:Array,staffOffset:Array,trackIndex:Number,wrong_notes:Array,wrong_events:Array,measureInfo:Object,oneline:Boolean},data:function(){var t=new ot(this._props);return this.obj=t,{shapes:t.shapes,items:t.items,rects:t.rects}},computed:{allNotes:function(){var t=[];if(void 0!==this.measure.mrest)return t;if(!this.jianpu&&this.addedNotes&&this.measure.notes){var s,i=n(this.addedNotes);try{for(i.s();!(s=i.n()).done;){var o=s.value;h.calcNoteElem(o,this.curClefs,this.curFifths)}}catch(u){i.e(u)}finally{i.f()}t=[].concat(e(this.measure.notes),e(this.addedNotes))}else t=this.measure.notes;var a,r=0,l=n(t);try{for(l.s();!(a=l.n()).done;){var c=a.value;void 0!==this.trackIndex&&c.staff&&(c.class="track"+(this.trackIndex+c.staff-1));var f=this.getNoteProp(c,r);c.items=U.getDrawItems(f,this.jianpu,this.innerJianpu),r+=1}}catch(u){l.e(u)}finally{l.f()}return t},timex:function(){return this.obj.timex},beatTicks:function(){return this.obj.beatTicks},flags:function(){return this.obj.flagItems(this.measureInfo.flags)},noteOffsetx:function(){return this.keyw?this.keyw:0}},methods:{getFifthsParam:function(){return this.obj.getFifthsParam()},getNoteClass:function(t,e){var s="";return void 0!==e&&t.staff&&(s="track"+(e+t.staff-1)),s},getNoteProp:function(t,e){return{note:t,staffDistance:this.staffDistance,lineh:this.lineh,measWidth:this.w,measMargin:this.obj.getMeasMargin(this.jianpu),noteOffsetx:this.noteOffsetx,curFifths:this.curFifths,notes:this.measure.notes,nextNote:this.obj.nextNote(e),beatTicks:this.beatTicks,staffLines:this.staffLines,staffOffset:this.staffOffset,jianpu:this.jianpu,innerJianpu:this.innerJianpu,curClefs:this.curClefs}},getNoteItems:function(t,e){var s=this.getNoteProp(t,e);return U.getDrawItems(s,this.jianpu,this.innerJianpu)},yOfLine:function(t,e,s){var i=this.getNoteProp(e,s);return U.yOfLine(i,t,e.staff)},getBarlines:function(t){var e={lineh:this.lineh,staffLines:this.staffLines,staffDistance:this.staffDistance,groupInfo:this.groupInfo,jianpu:0!==this.jianpu,staffOffset:this.staffOffset};return t?(e.x=this.obj.getBarlinex(),e.bar=this.measure.lbar):(e.x=this.w-(this.keyw?this.keyw:0),e.bar=this.measure.rbar),class{static getBarlines(t){const e=[];if(t.jianpu){const s=this.staffH(1,t);for(const i of t.staffOffset){const n=i+9;t.bar?this.drawBarline(e,n,s,1,t):e.push({x1:t.x,x2:t.x,y1:n,y2:n+s,"stroke-width":1.5})}}else{const s=t.groupInfo.h;t.bar?this.drawBarline(e,0,s,t.groupInfo.staves,t):e.push({x1:t.x,x2:t.x,y1:0,y2:s,"stroke-width":1.5})}return e}static staffH(t,e){let s=4;return e.staffLines&&e.staffLines[t]>3&&(s=e.staffLines[t]-1),s*e.lineh}static drawBarline(t,e,s,i,n){const o=n.bar,a=n.lineh,r=n.staffDistance;let l=n.x;if("light-heavy"===o.type?(t.push({x1:l-6,x2:l-6,y1:e,y2:e+s}),t.push({x1:l-2,x2:l-2,y1:e,y2:e+s,"stroke-width":4})):"heavy-light"===o.type?(t.push({x1:l-2,x2:l-2,y1:e,y2:e+s,"stroke-width":4}),t.push({x1:l+2,x2:l+2,y1:e,y2:e+s})):"light-light"===o.type?(t.push({x1:l-3,x2:l-3,y1:e,y2:e+s}),t.push({x1:l-0,x2:l-0,y1:e,y2:e+s})):"dashed"===o.type?t.push({x1:l-0,x2:l-0,y1:e,y2:e+s,"stroke-dasharray":"3,3"}):"none"!==o.type&&console.log("Todo to draw barline:"+o.type),o.repeat){l="forward"===o.repeat?l+6:l-a;let s=e;const n=.4*a;for(let e=0;e<i;e++){let e=s+1.5*a;t.push({x1:l,x2:l,y1:e,y2:e,"stroke-width":n,"stroke-linecap":"round"}),e=s+2.5*a,t.push({x1:l,x2:l,y1:e,y2:e,"stroke-width":n,"stroke-linecap":"round"}),s+=r+4*a}}}}.getBarlines(e)},onClickNote:function(t){console.log("onClickNote",t);var e,s="";if(t.arts){var i,o=n(t.arts);try{for(o.s();!(i=o.n()).done;){var a=i.value;"fingering"===a.type&&(e=a,s=a.val)}}catch(r){o.e(r)}finally{o.f()}}s=prompt("finger:",s),console.log("finger",s),s&&(t.arts||(t.arts=[]),e?e.val=s:t.arts.push({up:!0,x:2,type:"fingering",y:-48,val:s,hide:!0}))}},components:{SvgNoteElem:J,SvgTime:C,SvgClef:G,MeasHarmony:tt,MeasPdirOctave:et,NoteSlur:L,NoteTuplet:E,NoteSlide:R,MeasPdirWedge:st,SvgFifths:A,MeasEnding:nt,MeasPdirBracket:it,NoteLyrics:z,NoteWaveline:P,NoteTremolo:D}},void 0,!1,void 0,!1,void 0,void 0,void 0);class rt{constructor(t){this.prop=t}getFifths(){const t=this.prop.lineStaff,e=this.prop.measures,s=[{x:this.fifthsx(),fifths:t.fifths,clef:t.clef}];if(!this._hideChanged()&&this.prop.m2<e.length){const i=e[this.prop.m2];if(i.fifths){const e=this.prop.width-this._lineEndWidth()+this.prop.lineh/2,n=Object.assign(Object.assign({},i.fifths),{x:e,clef:t.clef});s.push(n)}}return s}fivelines(t){const e=this.prop.lineStaff,s=[];let i=0;const n=e.staves||1;for(let o=1;o<=n;o++){if(this._staffHide(o))continue;let n=5;const a=e.details?e.details[o]:void 0;if(a&&void 0!==a.lines&&(n=a.lines),n>0){const t={y:i,lines:n,class:"track"+(this.prop.trackIndex+o-1)};s.push(t)}i=t[o]}return s}staffLines(){if(!this.prop.lineStaff.details)return;const t={};for(const e of Object.keys(this.prop.lineStaff.details)){const s=this.prop.lineStaff.details[e];void 0!==s.lines&&(t[e]=s.lines)}return t}getClefs(){const t=[],e=this.prop.lineStaff.staves||1;for(let s=1;s<=e;s++){if(this._staffHide(s))continue;const e=this.prop.lineStaff.clef[""+s],i={x:.6*this.prop.lineh,clef:e,staff:s};t.push(i)}if(this.prop.m2<this.prop.measures.length){const e=this.prop.measures[this.prop.m2];if(e.clefs)for(const s of e.clefs)if(s.x<30){const e=this.prop.width-this._lineEndWidth()-2.6*this.prop.lineh,i=Object.assign(Object.assign({},s),{x:e,scale:.7});t.push(i)}}return t}_timeChanged(){if(this.prop.m2<this.prop.measures.length){const t=this.prop.measures[this.prop.m2];if(t.time)return t.time}}_measWidth(t){if(t.mm===this.prop.m2-1){const e=this.prop.jianpu?0:this._lineEndWidth();if(e)return t.info.w-e}return t.info.w}_staffHide(t){if(this.prop.oneline)return!1;const e=this.prop.lineStaff.details?this.prop.lineStaff.details[t]:null;return!(!e||!e.hide)}_groups(){const t=this.prop.lineStaff.staves||1;if(t<2)return[];const e=this.prop.lineh,s=this.prop.lineStaff.height?this.prop.lineStaff.height*e/10:4*e;if(s>4*e){let i=s;t>2&&this.prop.groupInfo&&(i=this.prop.groupInfo.h);const n=2.96*i;let o=-n/e/5;this.prop.jianpu&&(o+=(Math.abs(this.prop.lineStaff.fifths)+2.8)*e,o*=n/600);return[{x:o,y:i,"font-size":n,text:O.Group,transform:`scale(${600/n}, 1)`}]}return[]}fifthsx(){let t=0;return this.prop.lineStaff.clef&&(t+=4*this.prop.lineh),t}_hideChanged(){if(this.prop.m2>0&&this.prop.m2<this.prop.measures.length){const t=this.prop.measures[this.prop.m2-1];if(t.rbar&&"light-heavy"===t.rbar.type&&!t.rbar.repeat)return!0}return!1}_lineEndWidth(){if(this._hideChanged())return 0;let t=0;if(this.prop.m2<this.prop.measures.length){const e=this.prop.measures[this.prop.m2];e.fifths&&(t=this.prop.lineh*(Math.abs(e.fifths.fifths)+2),e.fifths.cancel&&(t+=this.prop.lineh*Math.abs(e.fifths.cancel)))}return this._timeChanged()&&(t+=2.5*this.prop.lineh),t}}const lt=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.x+","+t.lineStaff.y+")"}},[t.lineStaff.name?[s("text",{attrs:{x:t.jianpu?0:3*-t.lineh,y:t.staffHeight/2+t.lineh,"font-size":2*t.lineh,fill:"black","text-anchor":"end"}},[t._v(t._s(t.lineStaff.name))])]:t._e(),t._v(" "),t._l(t._groups(),(function(e,i){return s("text",t._b({key:"g"+i},"text",e,!1),[t._v(t._s(e.text))])})),t._v(" "),t.jianpu?t._e():[t.oneline&&t.musScore.onelineHead.mm>0?[s("StaffHead",{attrs:{x:t.musScore.onelineHead.x,fifths:t.musScore.onelineHead.fifths,time:t.musScore.onelineHead.time,lineh:t.lineh,staffOffset:t.staffOffset,staffInfo:t.musScore.onelineHead.headLines[t.lineIndex].headStaves[t.staffIndex],height:t.lineStaff.height||4*t.lineh,color:t.musScore.onelineHead.color,measNum:t.measures[t.musScore.onelineHead.mm].num,trackIndex:t.trackIndex}})]:t._e(),t._v(" "),t._l(t.fivelines,(function(e,i){return s("SvgFiveLine",t._b({key:i,attrs:{x:0,width:t.width,lineh:t.lineh}},"SvgFiveLine",e,!1))}))],t._v(" "),t.jianpu?t._e():[[s("SvgClef",{attrs:{clefs:t.getClefs,lineh:t.lineh,staffOffset:t.staffOffset,trackIndex:t.trackIndex}})],t._v(" "),t._l(t.getFifths,(function(e,i){return[s("SvgFifths",t._b({key:"f"+i,attrs:{staffOffset:t.staffOffset,staves:t.lineStaff.staves,lineh:t.lineh,trackIndex:t.trackIndex}},"SvgFifths",e,!1))]})),t._v(" "),t.lineStaff.time?[s("SvgTime",{attrs:{time:t.lineStaff.time,x:t.timex,lineh:t.lineh,staffOffset:t.staffOffset,staves:t.lineStaff.staves,trackIndex:t.trackIndex}})]:t._e(),t._v(" "),t.changedTime?[s("SvgTime",{attrs:{time:t.changedTime,x:t.width-2*t.lineh,lineh:t.lineh,staffOffset:t.staffOffset,staves:t.lineStaff.staves,trackIndex:t.trackIndex}})]:t._e()],t._v(" "),t._l(t.measureInfos,(function(e,i){return[t.mountMeas0<0||e.mm>=t.mountMeas0&&e.mm<t.mountMeas1?s("SvgMeasure",{key:"m"+i,attrs:{measure:t.measures[e.mm],measureIndex:e.mm,x:t.jianpu&&0==e.mm?e.x-20:e.x,isFirstMeasure:0==i,isTopMeasure:0==t.staffIndex,staffDistance:t.distance,lineh:t.lineh,curFifths:t.lineStaff.fifths,curClefs:t.lineStaff.clef,jianpu:t.jianpu,innerJianpu:t.innerJianpu,continues:0==i?t.continues:void 0,keyw:t.m1>0?0:e.info.keyw,staffLines:t.staffLines,w:t._measWidth(e),measures:t.measures,groupInfo:t.groupInfo,addedNotes:t.curAddedNotes(e.mm),staffOffset:t.staffOffset,trackIndex:t.trackIndex,wrong_notes:t.compile_status?t.compile_status.losed_notes:null,wrong_events:t.compile_status&&t.compile_status.more_events?t.compile_status.more_events[e.mm]:null,measureInfo:e,oneline:t.oneline}}):t._e()]}))],2)},staticRenderFns:[]},void 0,{name:"SvgLineStaff",props:{lineStaff:Object,lineIndex:Number,staffIndex:Number,lineh:Number,x:Number,width:Number,measures:Array,m1:Number,m2:Number,continues:Array,jianpu:Number,innerJianpu:Number,groupInfo:Object,mountMeas:Number,mountMeas0:Number,mountMeas1:Number,addedNotes:Array,oneline:Boolean,trackIndex:Number,compile_status:Object,musScore:Object},data:function(){this.obj=new rt(this._props);for(var t=0,e=[],s=this.lineStaff.staves||1,i=1;i<=s;i++)this.obj._staffHide(i)?e.push(-1):(e.push(t),i<this.lineStaff.distances.length&&(t+=4*this.lineh+this.lineStaff.distances[i]*this.lineh/10));return{distance:this.lineStaff.distances[this.lineStaff.distances.length-1]*this.lineh/10,staffHeight:this.lineStaff.height?this.lineStaff.height*this.lineh/10:4*this.lineh,staffOffset:e}},computed:{measureInfos:function(){return this.musScore.getMeasureInfos(this.lineIndex)},timex:function(){return this.lineh*(4.5+Math.abs(this.lineStaff.fifths))},fivelines:function(){return this.obj.fivelines(this.staffOffset)},staffLines:function(){return this.obj.staffLines()},getFifths:function(){return this.obj.getFifths()},getClefs:function(){return this.obj.getClefs()},changedTime:function(){return this.obj._timeChanged()}},methods:{curAddedNotes:function(t){var e=null;return this.addedNotes&&(e=this.addedNotes.filter((function(e){return e.mm===t}))),e&&e.length>0?e:null},_measWidth:function(t){return this.obj._measWidth(t)},_groups:function(){return this.obj._groups()}},components:{SvgFiveLine:T,SvgMeasure:at,SvgFifths:A,SvgTime:C,SvgClef:G,StaffHead:_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{transform:"translate("+t.x+",0)"}},[s("rect",{style:"fill:"+t.color+";",attrs:{x:-40,y:-60,width:7*t.lineh+t.timex,height:t.height+120}}),t._v(" "),s("text",{attrs:{x:0,y:2*-t.lineh,"font-size":1.2*t.lineh}},[t._v(t._s(t.measNum))]),t._v(" "),s("SvgClef",{attrs:{clefs:t.staffInfo.mclefs,lineh:t.lineh,staffOffset:t.staffOffset,trackIndex:t.trackIndex}}),t._v(" "),s("SvgFifths",t._b({attrs:{staffOffset:t.staffOffset,staves:t.staffInfo.staves,lineh:t.lineh,trackIndex:t.trackIndex}},"SvgFifths",t.f,!1)),t._v(" "),s("SvgTime",{attrs:{time:t.time,x:t.timex,lineh:t.lineh,staffOffset:t.staffOffset,staves:t.staffInfo.staves,trackIndex:t.trackIndex}})],1)},staticRenderFns:[]},void 0,{name:"StaffHead",props:{staffOffset:Array,lineh:Number,trackIndex:Number,staffInfo:Object,x:Number,fifths:Number,time:Object,height:Number,color:String,measNum:String},components:{SvgFifths:A,SvgTime:C,SvgClef:G},computed:{f:function(){var t={x:4*this.lineh,fifths:this.fifths,clef:this.staffInfo.clefs};return t},timex:function(){return(Math.abs(this.fifths)+5)*this.lineh}}},void 0,!1,void 0,!1,void 0,void 0,void 0)}},void 0,!1,void 0,!1,void 0,void 0,void 0);class ht{constructor(t){this.prop=t}leftMargin(){return this.prop.jianpu?this.prop.page.x/2:this.prop.page.x}barlineParam(){const t=this.prop.mline.lineStaves;let e=this.leftMargin();this.prop.jianpu&&(e+=(Math.abs(t[0].fifths)+3)*this.prop.lineh);let s=this.prop.mline.h;if(this.prop.mline.oneline){s=4*this.prop.lineh;for(const e of t)if(!e.hidden&&e.staves>1)for(let t=1;t<e.staves;t++)e.details&&e.details[t]&&e.details[t].hide||(s+=e.distances[t]*this.prop.lineh/10+4*this.prop.lineh)}return{x1:e,x2:e,y1:0,y2:s}}isHidden(t){if(t.hidden)return!0;if(this.prop.mline.oneline)return!1;if(t.details){let e=!0;const s=t.staves||1;for(let i=1;i<=s;i++)if(!t.details[i]||!t.details[i].hide){e=!1;break}return e}return!1}trackIndex(t){let e=0;for(let s=0;s<t;s++){e+=this.prop.mline.lineStaves[s].staves||1}return e}groupInfo(t){const e=this.prop.lineh,s=this.prop.mline.lineStaves,i=s[t];let n=i.staves?i.staves:1,o=0;for(const a of this.prop.groups){if(i.parti===a.p1){if(n=a.p2-a.p1+1,n>1&&t<s.length-1){o=0,n=0;for(let i=t;i<s.length&&i<=a.p2;i++){const a=s[i];this.isHidden(a)||(n+=a.staves||1,o+=4*e,i>t&&(o+=a.distances[0]))}o>0&&(o-=4*e)}break}if(i.parti===a.p2){n=1,o=0;break}}return 0===o&&(o=i.height||4*e),n>0?{staves:n,h:o}:null}groupParam(t){const e=this.prop.mline.lineStaves,s=this.prop.lineh;let i=-1,n=0,o=0;for(const r of e)i<0&&r.parti>=t.p1&&!r.hidden&&(i=r.y),r.parti<=t.p2&&!r.hidden&&(n=r.y+4*s,r.staves&&(n+=(r.staves-1)*(4*s+r.distances[0])),o++);if(1===o)return;let a=this.leftMargin()-s;return this.prop.jianpu&&(a+=(Math.abs(e[0].fifths)+3)*s,0===this.prop.lineIndex&&(a+=2*s)),{type:t.type,x:a,y1:i,y2:n}}}const ct=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{attrs:{id:"line_"+t.lineIndex,transform:t.transform}},[t.mline.h>4*t.lineh?s("line",t._b({attrs:{stroke:"black","stroke-width":"1.0"}},"line",t.barlineParam(),!1)):t._e(),t._v(" "),t.mline.h>4*t.lineh?[t._l(t.groups,(function(e,i){return[s("SvgGroup",t._b({key:"g"+i,attrs:{lineh:t.lineh}},"SvgGroup",t.groupParam(e),!1))]}))]:t._e(),t._v(" "),!t.jianpu&&t.measNum>1?[s("text",{attrs:{x:0,y:2*-t.lineh,"font-size":1.2*t.lineh}},[t._v(t._s(t.measNum))])]:t._e(),t._v(" "),0===this.lineIndex&&t.jpStaff&&2!=t.jianpu?[s("SvgFifths",{attrs:{fifths:t.jpStaff.fifths,x:t.jpFifthsPos.x,y:t.jpFifthsPos.y,lineh:t.lineh,jianpu:!0,trackIndex:1}}),t._v(" "),t.jpStaff.time?[s("SvgTime",{attrs:{time:t.jpStaff.time,x:t.jpFifthsPos.x+6*t.lineh,lineh:t.lineh,basey:t.jpFifthsPos.y-2*t.lineh,jianpu:!0}})]:t._e()]:t._e(),t._v(" "),0===this.lineIndex&&t.jpStaff&&2==t.jianpu?[s("text",{attrs:{x:t.jpFifthsPos.x,y:t.jpFifthsPos.y,"font-size":2*t.lineh}},[t._v("固定调简谱")])]:t._e(),t._v(" "),t._l(t.mline.lineStaves,(function(e,i){return[t.isHidden(e)?t._e():s("SvgLineStaff",{key:i,attrs:{lineIndex:t.lineIndex,staffIndex:i,lineStaff:e,x:t.leftMargin(),width:t.mline.w,lineh:t.lineh,jianpu:t.parts[e.parti].jianpu||t.jianpu,innerJianpu:t.innerJianpu,m1:t.mline.m1,m2:t.mline.m2,musScore:t.musScore,groupInfo:t.groupInfo(i),continues:t.continues?t.continues[i]:null,measures:t.parts[e.parti].measures,trackIndex:t.trackIndex(i),addedNotes:t.curAddedNotes(i),mountMeas0:t.mountMeas0,mountMeas1:t.mountMeas1,oneline:t.mline.oneline,compile_status:t.compile_status}})]}))],2)},staticRenderFns:[]},void 0,{name:"SvgLine",props:{mline:Object,parts:Array,lineh:Number,lineIndex:Number,musScore:Object,groups:Array,page:Object,jianpu:Number,innerJianpu:Number,continues:Object,nextLine:Object,jpFifthsPos:Object,addedNotes:Array,mountMeas0:Number,mountMeas1:Number,compile_status:Object},components:{SvgLineStaff:lt,SvgGroup:j,SvgFifths:A,SvgTime:C},data:function(){this.obj=new ht(this._props);var t="translate("+this.mline.x+","+this.mline.y+")";return this.scale&&(t+="scale("+this.mline.scale+","+this.mline.scale+")"),{transform:t,measNum:this.parts[0].measures[this.mline.m1].num}},computed:{jpStaff:function(){var t=this.jianpu?this.mline.lineStaves[0]:void 0;if(!t){var e,s=n(this.mline.lineStaves);try{for(s.s();!(e=s.n()).done;){var i=e.value;if(this.parts[i.parti].jianpu){t=i;break}}}catch(o){s.e(o)}finally{s.f()}}return t}},methods:{curAddedNotes:function(t){var e=null;return this.addedNotes&&(e=this.addedNotes.filter((function(e){return e.partIndex===t}))),e},leftMargin:function(){return this.obj.leftMargin()},barlineParam:function(){return this.obj.barlineParam()},isHidden:function(t){return this.obj.isHidden(t)},trackIndex:function(t){return this.obj.trackIndex(t)},groupInfo:function(t){return this.obj.groupInfo(t)},groupParam:function(t){return this.obj.groupParam(t)}}},void 0,!1,void 0,!1,void 0,void 0,void 0);class ft{constructor(t={rights:"虫虫音乐"},e,s,i){this.rights=t.rights,this.rightsSize=t.size?t.size*ft.scale:1.5*i,this.pagination=e+"/"+s,this.paginationSize=t.size?t.size*ft.scale:1.5*i}}ft.scale=3.8;const ut=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{staticClass:"footer"},[t.obj.rights?[s("text",{staticClass:"print",attrs:{x:t.pagex+t.x,y:t.rightsy,"font-size":t.obj.rightsSize,"text-anchor":"middle"}},[t._v(t._s(t.obj.rights))])]:t._e(),t._v(" "),t.obj.pagination?[s("text",{attrs:{x:t.pagex+t.x,y:t.paginationy,"font-size":t.obj.paginationSize,"text-anchor":"middle"}},[t._v(t._s(t.obj.pagination))])]:t._e()],2)},staticRenderFns:[]},(function(t){t&&t("data-v-5c1c5b43_0",{source:".footer[data-v-5c1c5b43]{font-family:Times New Roman,Times,serif;white-space:pre}",map:void 0,media:void 0})}),{name:"SvgFooter",props:{x:Number,y:Number,pagex:{type:Number,default:0},lineh:Number,footer:Object,pageIndex:Number,pageCount:Number},data:function(){return{obj:new ft(this.footer,this.pageIndex,this.pageCount,this.lineh)}},computed:{rightsy:function(){var t=this.y;return t},paginationy:function(){return this.rightsy+this.obj.rightsSize+.5*this.lineh}}},"data-v-5c1c5b43",!1,void 0,!1,N,void 0,void 0),pt=require("qrcodejs2");class mt{constructor(t={link:"https://a.app.qq.com/o/simple.jsp?pkgname=com.yusi.chongchong",title:"打开“虫虫钢琴APP”\n扫一扫，听音频"},e,s,i,n){this.titles=t.title?t.title.split("\n"):void 0,this.titleSize=t.titlesize?t.titlesize*mt.scale:1.5*n,this.createQrcode(t.link,e,s,i)}createQrcode(t,e,s,i){const n=document.createElement("div");new pt(n,{height:100,useSVG:!0,width:100}).makeCode(t);const o=n.firstChild;o&&(n.removeChild(o),o.setAttribute("id","qrcode"),o.setAttribute("x",e+""),o.setAttribute("y",s+""),o.setAttribute("width",i+""),o.setAttribute("height",i+""),this.qrcode=o.outerHTML)}}mt.scale=3.8;const dt=_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.musScore.display?s("svg",t._b({staticClass:"scorefont",class:t.disableClass,style:"zoom:"+t.musScore.scale,attrs:{id:"svg",version:"1.1",xmlns:"http://www.w3.org/2000/svg"}},"svg",t.musScore.svgSize,!1),[t._t("background",[t._l(t.musScore.pages,(function(e,i){return[e.fill?s("rect",{key:"b"+i,staticClass:"noprint",attrs:{x:e.x,y:e.y,width:e.w,height:e.h,fill:e.fill}}):t._e()]}))]),t._v(" "),t.musScore.displayParam.showVersion?s("text",{staticClass:"noprint",attrs:{x:5,y:20,fill:"gray"}},[t._v(t._s(t.score.ver)+"-0401")]):t._e(),t._v(" "),t._t("measurebg",[t._l(t.musScore.hiMeasures,(function(e,i){return[s("rect",t._b({key:"r"+i,staticClass:"noprint"},"rect",e,!1))]}))]),t._v(" "),t._t("cursorbg"),t._v(" "),t._l(t.musScore.pages,(function(e,i){return[t.mountPage0<0||i>=t.mountPage0&&i<t.mountPage1?s("g",{key:"p"+i,attrs:{id:"page_"+i,transform:"translate("+e.x+","+e.y+")"}},[t.musScore.displayParam.noPrintWatermark?t._e():s("g",{staticClass:"print"},[s("image",{attrs:{x:3*e.w/5,y:3*e.h/4,width:1.1*e.w/4,height:e.w/4,href:"./assets/watermark.svg"}})]),t._v(" "),e.title?s("SvgTitle",{attrs:{title:t.score.title,lineh:t.lineh,pagex:t.musScore.page.x,x:t.getTitlex(e),y:e.titley}}):t._e(),t._v(" "),e.ls>0?t._l(e.ls,(function(i){return s("SvgLine",{key:"l"+e.l1+i,attrs:{lineIndex:e.l1+i-1,mline:t.musScore.lines[e.l1+i-1],musScore:t.musScore,lineh:t.lineh,parts:t.score.parts,groups:t.score.groups||[],page:t.musScore.page,jianpu:t.musScore.jianpu,innerJianpu:t.innerJianpu,continues:t.musScore.getContinueItem(e.l1+i-1),nextLine:i<t.musScore.lines.length-1?t.musScore.lines[e.l1+i]:null,jpFifthsPos:t.musScore.jpFifthsPos,addedNotes:t.musScore.addedNotes,mountMeas0:t.mountMeas0,mountMeas1:t.mountMeas1,compile_status:t.compile_status}})})):t._e(),t._v(" "),"onepaged"==t.musScore.display?s("SvgFooter",{attrs:{footer:t.score.footer,pageIndex:i+1,pageCount:t.musScore.pages.length,lineh:t.lineh,pagex:t.musScore.page.x,x:e.w/2,y:e.h-5*t.lineh}}):t._e(),t._v(" "),0==i&&t.score.qrcode&&!t.musScore.displayParam.noPrintQrcode?s("SvgQrcode",{attrs:{qrcode:t.score.qrcode,pagex:t.musScore.page.x,x:2*t.lineh,y:2*t.lineh,lineh:t.lineh}}):t._e(),t._v(" "),"onepaged"==t.musScore.display?s("g",{staticClass:"noprint"},[s("rect",{attrs:{width:e.w,height:2*t.lineh,y:e.h-2*t.lineh,fill:"#696969"}})]):t._e()],2):t._e()]})),t._v(" "),t._t("foreground")],2):s("div",[t._v("\n    >>\n")])},staticRenderFns:[]},(function(t){t&&(t("data-v-1d111dd8_0",{source:".disable0 .track0,.disable1 .track1,.disable10 .track10,.disable11 .track11,.disable2 .track2,.disable3 .track3,.disable4 .track4,.disable5 .track5,.disable6 .track6,.disable7 .track7,.disable8 .track8,.disable9 .track9{fill:#d3d3d3;stroke:#d3d3d3}",map:void 0,media:void 0}),t("data-v-1d111dd8_1",{source:".scorefont[data-v-1d111dd8]{font-family:Aloisen New,Arial,Times New Roman,Times,serif}@media print{.noprint[data-v-1d111dd8]{display:none}.print[data-v-1d111dd8]{display:block}}@media screen{.print[data-v-1d111dd8]{display:none}}",map:void 0,media:void 0}))}),{name:"SvgScore",props:{score:{type:Object,required:!0},lineh:{type:Number,default:10},config:Object,compile_status:Object},data:function(){var t=new x(this.score,this.lineh,this.config);this.config.displayParam&&this.config.displayParam.jianpu&&(t.jianpu=1),this.config.displayParam&&this.config.displayParam.innerJianpu?this.innerJianpu=1:this.innerJianpu=0;var e=0,s=0;return this.config.showall&&(e=1e4,s=1e5),{musScore:t,orig_fifths:this.score.fifths,fifths:this.score.fifths,jianpu:this.jianpu,innerJianpu:this.innerJianpu,cursor:{},startTime:0,usedTime:0,disableClass:{},mountPage0:0,mountPage1:e,mountMeas0:0,mountMeas1:s}},components:{SvgTitle:w,SvgLine:ct,SvgFooter:ut,SvgQrcode:_({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("g",{staticClass:"qrcode print"},[t.obj.qrcode?[s("g",{domProps:{innerHTML:t._s(t.obj.qrcode)}})]:t._e(),t._v(" "),t.obj.titles&&t.obj.titles.length>0?t._l(t.obj.titles,(function(e,i){return s("text",{key:"qrcode"+i,attrs:{x:t.qrcodeSize+t.pagex+t.x+3*t.lineh,y:t.y+2*t.lineh+t.qrcodeSize/2-t.obj.titleSize*t.obj.titles.length/2-t.lineh*(t.obj.titles.length-1)/2+(t.obj.titleSize+t.lineh)*i+t.obj.titleSize,"font-size":t.obj.titleSize}},[t._v(t._s(e))])})):t._e()],2)},staticRenderFns:[]},(function(t){t&&t("data-v-38b00224_0",{source:".qrcode[data-v-38b00224]{font-family:Times New Roman,Times,serif;white-space:pre}",map:void 0,media:void 0})}),{name:"SvgQrcode",props:{x:Number,y:Number,pagex:{type:Number,default:0},lineh:Number,qrcode:Object,qrcodeSize:{type:Number,default:100}},data:function(){return{obj:new mt(this.qrcode,this.pagex+this.x+2*this.lineh,this.y+2*this.lineh,this.qrcodeSize,this.lineh)}}},"data-v-38b00224",!1,void 0,!1,N,void 0,void 0)},mounted:function(){this.$emit("svgmounted")},methods:{setScore:function(t){this.musScore=new x(t,this.lineh,this.config),this.config.displayParam&&this.config.displayParam.jianpu&&(this.musScore.jianpu=1)},getTitlex:function(t){var e=t.titlex;return this.musScore.jianpu&&(e-=this.musScore.page.x/4),e},transFifths:function(t){if(t!==this.fifths){var e=t;this.musScore.transposeKey(this.fifths,e),this.fifths=e}},highlightMeasure:function(t){this.musScore.hiMeasures=[];var e,s=n(t);try{for(s.s();!(e=s.n()).done;){var i=e.value;this.musScore.addFlag({type:"rect",mm:i})}}catch(o){s.e(o)}finally{s.f()}},showStaffHead:function(t,e){this.musScore.showStaffHead(t,e)},showCursor:function(t,e,s){var i=this.musScore.posOf(t,e,s);if(i)return this.cursor=i,i},getMeasureRect:function(t){var e=this.musScore.measureInfos[t];return{x:this.musScore.measurex(e),y:e.pagey+e.liney,height:e.h,width:e.w}},updateCursorPos:function(t){if(t){var e=this.musScore.posOf(t.mm,t.nn,t.percent);e&&(this.cursor=e)}},getPrefSize:function(t){return this.musScore.getPrefSize(t)},showParts:function(t){this.musScore.showParts(t),this.$nextTick((function(){this.$emit("svgrendered")}))},setTrackStyle:function(t,e){var s,i={},o=n(t);try{for(o.s();!(s=o.n()).done;){i["disable"+s.value]=!0}}catch(a){o.e(a)}finally{o.f()}this.disableClass=i},setTrackClass:function(t){this.disableClass=t},setDisplayMode:function(t,e){e.jianpu&&(this.musScore.jianpu=1),e.innerJianpu&&(this.innerJianpu=1),this.config.showall||("oneline"===t?(this.mountPage0=-1,this.mountPage1=0,this.mountMeas0=0,this.mountMeas1=0):(this.mountPage0=0,this.mountPage1=0,this.mountMeas0=-1,this.mountMeas1=0)),this.musScore.setDisplayMode(t,e),this.$nextTick((function(){this.$emit("svgrendered")}))},setOnepageMode:function(t){this.setDisplayMode("onepage",t)},setHorpageMode:function(t){this.setDisplayMode("horpage",t)},setOnelineMode:function(t){this.setDisplayMode("oneline",t)},showJianpu:function(t,e){this.musScore.setJianpu(t,e)},showInnerJianpu:function(t){this.innerJianpu=t,this.musScore.continues=null},addNote:function(t,e,s,i){this.musScore.addNoteId(t,e,s,i)},clearNotes:function(t){this.musScore.clearNotes(t)},clearAllNotes:function(){this.musScore.addedNotes=null},getMeasurePos:function(t){return this.musScore.getMueasurePos(t)},getNotePos:function(t){return this.musScore.getNotePos(t)},getNoteInfo:function(t){return this.musScore.getNoteInfo(t)},setNoteColor:function(t,e){return this.musScore.setNoteColor(t,e)},setStemColor:function(t,e){return this.musScore.setStemColor(t,e)},showFlag:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.musScore.addFlag(t)},clearFlag:function(t){this.musScore.clearFlag(t)},setMountPages:function(t,e){this.mountPage0=t,this.mountPage1=t+e,this.mountMeas0=-1},setMountMeas:function(t,e){this.mountMeas0=t,this.mountMeas1=t+e,this.mountPage0=-1},onClickMeas:function(t){},getOffsetLeft:function(t){return t.offsetParent?t.getOffsetLeft+this.getOffsetTop(t.offsetParent):t.getOffsetLeft},getOffsetTop:function(t){return t.offsetParent?t.offsetTop+this.getOffsetTop(t.offsetParent):t.offsetTop},onTouchStart:function(t){var e=t.targetTouches[0];this.touchX=e.screenX,this.touchY=e.screenY},onTouchEnd:function(t){var e=t.changedTouches[0];if(!(Math.abs(e.screenX-this.touchX)+Math.abs(e.screenY-this.touchY)>20)){var s=document.querySelector("#svg").parentElement,i=this.getOffsetTop(s),n=e.pageX,o=e.pageY-i,a=this.musScore.getTouchPos(n,o);a&&this.$emit("clickmeas",a)}},onMouseDown:function(t){this.touchX=t.screenX,this.touchY=t.screenY},onMouseUp:function(t){var e=t;if(!(Math.abs(e.screenX-this.touchX)+Math.abs(e.screenY-this.touchY)>20)){var s=document.querySelector("#svg").parentElement,i=this.getOffsetTop(s),n=e.pageX,o=e.pageY-i,a=this.musScore.getTouchPos(n,o);a&&this.$emit("clickmeas",a)}},getPages:function(){return this.musScore.pages},getPageSvg:function(){for(var t=[],e=this.musScore.pages.length,s='width="100%" height="%100" viewBox="0 0 '.concat(this.score.page.w," ").concat(this.score.page.h,'"'),i=0;i<e;i++){var n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" '.concat(s,' style="zoom: ').concat(this.musScore.scale,';">');n+=document.getElementById("page_"+i).innerHTML,n+="</svg>",t.push(n)}return t},onrotate:function(t){var e=document.documentElement.clientWidth;console.log("orientation=",window.orientation,",scale=",this.musScore.scale,e/this.score.page.w,",screen width=",screen.width,",screen height=",screen.height),this.musScore.scale=e/this.musScore.page.w},changeKey:function(t){this.musScore.changeKey(t)}}},"data-v-1d111dd8",!1,void 0,!1,N,void 0,void 0);var yt=function t(e,s){if(!t.installed){var i,n=s||{};if(n.plugins){var o=dt.mixins||[];o=o.concat(n.plugins),i=Object.assign(dt,{mixins:o})}else i=dt;e.component(dt.name,i)}};"undefined"!=typeof window&&window.Vue&&yt(window.Vue);var xt={install:yt};export default xt;export{dt as SvgScore};
